<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>
    <head>
        <title>Logging in NetBeans</title>
    </head>
    <body>

    <center>
        <h1>Logging in NetBeans</h1>
    </center>

    <p>
    The logging system in NetBeans is based on the standard
    JDK's <a href="@JDK@/java/util/logging/package-summary.html">java.util.logging</a>
    and complies to it as much as possible. This document
    sumarizes the basic usecases and shall be treated as a guide for
    writing good NetBeans ready logging code. The
    info given here is valid for default configuration of the logger as
    it is used in NetBeans. However it is possible to fully replace
    the system by providing own logging properties as 
    in any 
    <a href="@JDK@/java/util/logging/LogManager.html">other JDK application</a>. 
    Then of course the behaviour may get completely 
    different.
    </p>

    <p>
    Rather than printing raw exceptions to the console
    or implementing custom debug or logging facililities, code may
    use the <a href="@JDK@/java/util/logging/Logger.html">Logger</a> 
    to access logging in a higher-level
    fashion. This way the logging messages can be dynamically turned
    on and off by single switch on command line or even during runtime.
    </p>
    
    <p>Another important thing is to chain stack traces to
    exceptions using 
    <a href="@JDK@/java/lang/Throwable.html#initCause(java.lang.Throwable)">
    Throwable.initCause(Throwable)</a>, permitting you to throw an exception 
    of a type permitted by your
    API signature while safely encapsulating the root cause of the problem (in terms
    of other nested exceptions). Code should use 
    <a href="@JDK@/java/util/logging/Logger.html#log(java.util.logging.Level,%20java.lang.String,%20java.lang.Throwable)">
    Logger.log(Level.SEVERE, msg, exception)</a>
    rather than directly printing caught exceptions,
    to make sure nested annotations are not lost and to allow pluged in
    handlers of logging to process the exceptions.
    </p>
        

    <!--
    <p>Also localized messages may be annotated 
    to exceptions so that code which can deal
    with a caught exception with a user-visible UI can display a 
    polite and helpful message.
    Messages with no localized annotation can be handled in 
    a default way while the details
    are reserved for the log file.
    </p>
    -->
    
    <p>
    It is possible to use 
    <a href="@JDK@/java/util/logging/Logger.html#getAnonymousLogger()">
        anonymous loggers
    </a>
    but it is preferred to create
    <a href="@JDK@/java/util/logging/Logger.html#getLogger(java.lang.String)">
        named and shared instances 
    </a> of loggers.
    The later has the advantage of finer control of what is going
    to be logged or not, as each named instance can be turned on/off 
    individually by using a command line property.
    </p>
    
<h3>Turning Logging On and Off</h3>    
    <p>
    As the logging system is completely JDK based, one can use the 
    traditional properties of 
    <a href="@JDK@/java/util/logging/LogManager.html">LogManager</a>
    and customize logging completely by themselves.
    </p>
    
    <p>
    However there is a simpler way how to enable logging of an named logger.
    Just start NetBeans with <code>-J-Dname.of.the.Logger.level=100</code>
    or any other number and all the log 
    <a href="@JDK@/java/util/logging/Logger.html">Level</a>s 
    with higher or equal value will immediatelly
    be enabled and handled by the system.
    </p>

    <p>
    It is possible to turn the logging dynamically when the application
    is running. It is enough to just:<pre>
System.setProperty("name.of.the.Logger.level", "100");
LogManager.getLogManager().readConfiguration();
</pre>
    and logging state for the <q>name.of.the.Logger</q> is changed. The
    first line in the above code snippet changes the global properties and
    the second one asks the system to refresh the configuration of all
    loggers in the system.
    </p>

    <p>
    Of course this only works if the default NetBeans logger is in place.
    Sometimes however it may make sence to provide completely different logger.
    This can be done by one of two JDK standard properties:
    <code>java.util.logging.config.file</code> or
    <code>java.util.logging.config.class</code> as described at
    <a href="@JDK@/java/util/logging/LogManager.html">LogManager's javadoc</a>.
    If these properties are provide during the startup of the system,
    then the logging is fully dedicated to the configured custom loggers
    and of course no NetBeans standard configuration properties work.
    </p>

<h3>How to Write Logging Friendly Code</h3>


<h5>Handling Exceptions</h5>

<p>
To handle an exception and sent it to the log file:
</p>
<pre>
private static Logger logger = Logger.getLogger("name.of.your.Logger");
try {
    foo.doSomething();
} catch (IOException ioe) {
    logger.log(Level.SEVERE, null, ioe);
}
</pre>

<p>If the exception is not important, and by default shall not
be shown or logged at all one can
use the <code>Level.FINE</code>, <code>Level.FINER</code> or
<code>Level.FINEST</code>:</p>
<pre>
try {
    foo.doSomething();
} catch (IOException ioe) {
    logger.log(Level.FINE, "msg", ioe);
}
</pre>

<h5>Retain nested stacktraces / change exception type</h5>
    
<p>
    To rethrow an exception use standard JDK's 
    <a href="@JDK@/java/lang/Throwable.html#initCause(java.lang.Throwable)">
    Throwable.initCause(Throwable)</a> method. It is going to
    be properly annotated and printed when sent to logger:
<pre>
public void doSomething() throws IOException {
    try {
        doSomethingElse();
    } catch (IllegalArgumentException iae) {
        IOException ioe = new IOException("did not work: " + iae);
        ioe.initCause(iae);
        throw ioe;
    }
}
// ...
try {
    foo.doSomething();
} catch (IOException ioe) {
    logger.log(Level.WARNING, null, ioe);
}
</pre>

<h5>Logging a warning and debug messages</h5>

<p>
Logging shall usually be done with a named loggers, as that allows
proper turning on and off from the command line. To log something
into the log file one should use Level.INFO or higher:
</p>

<pre>
private static final Logger LOG =
    Logger.getLogger("org.netbeans.modules.foo");
    
public void doSomething(String arg) {
    if (arg.length() == 0) {
        LOG.warning("doSomething called on empty string");
        return;
    }
    // ...
}
</pre>
<p>
For writing debugging messages it is also better to have a named logger,
but the important difference is to use <code>Level.FINE</code> and lower
severity levels:
</p>
<pre>
package org.netbeans.modules.foo;
class FooModule {
    public static final Logger LOG =
        Logger.getLogger("org.netbeans.modules.foo");
}
// ...
class Something {
    public void doSomething(String arg) {
        if (LOG.isLoggable(Level.FINER)) {
            LOG.log(Level.FINER, "Called doSomething with arg {0}", arg);
        }
    }
}
</pre>

<p>
These are the base patterns to be used when logging from inside of NetBeans.
A care has been taken to mimic as closely as possible the way logging is
done in any other system and as a result it should be pretty easy to smoothly
incorporate any 3rd party library into NetBeans that is using JDK's logging
or a wrapper around it.

<!-- Should there be more questions to ask, feel free to
consult the documentation that has been
<a href="http://openide.netbeans.org/tutorial/reviews/opinions_35067.html">created during the development</a>
and implementation of the logging functionality in NetBeans.
-->

</p>
  
  </body>
</html>
