/*
 *                 Sun Public License Notice
 *
 * The contents of this file are subject to the Sun Public License
 * Version 1.0 (the "License"). You may not use this file except in
 * compliance with the License. A copy of the License is available at
 * http://www.sun.com/
 *
 * The Original Code is NetBeans. The Initial Developer of the Original
 * Code is Sun Microsystems, Inc. Portions Copyright 2004-2005 Sun
 * Microsystems, Inc. All Rights Reserved.
 */
package org.netbeans.modules.jmx.mbeanwizard;

import java.awt.Component;
import javax.swing.event.*;
import java.io.File;
import java.util.ResourceBundle;

import org.netbeans.spi.project.ui.templates.support.Templates;
import org.netbeans.api.project.Project;
import org.openide.loaders.TemplateWizard;
import org.openide.WizardDescriptor;
import org.openide.util.HelpCtx;
import org.openide.util.NbBundle;
import org.openide.awt.Mnemonics;

import org.netbeans.modules.jmx.WizardConstants;
import org.netbeans.modules.jmx.WizardHelpers;
import org.netbeans.modules.jmx.GenericWizardPanel;
import java.awt.Container;
import java.awt.event.FocusEvent;
import java.awt.event.FocusListener;
import javax.swing.JTextField;
import org.netbeans.api.project.ProjectUtils;

/**
 *
 * Class handling the graphical part of the standard MBean wizard panel
 *
 */
public class StandardMBeanPanel extends javax.swing.JPanel
{
    private StandardMBeanWizardPanel wiz;
    private ResourceBundle bundle;
    
    // temporary: for now, the user can proceed to the next panel automaticely
    private boolean mbeanNameSelected = true;
    private boolean descHasChanged = false;
    private boolean updateNameRunning = false;
    private static enum mbeanType {StandardMBean, DynamicMBean, ExtendedStandardMBean};
    private static mbeanType selectedMBeanType;
    
    /**
     * Create the wizard panel component and set up some basic properties
     * @param wiz a wizard panel to fill with user information
     */
    public StandardMBeanPanel (StandardMBeanWizardPanel wiz) 
    {
        this.wiz = wiz;
        bundle = NbBundle.getBundle(StandardMBeanPanel.class);
        initComponents ();
        mbeanDescriptionJTextField.addFocusListener(new FocusListener() {
           private String description = null;
           public void focusGained(FocusEvent e) {
               description = mbeanDescriptionJTextField.getText();
           }
           public void focusLost(FocusEvent e) {
               if (!description.equals(mbeanDescriptionJTextField.getText())) {
                   descHasChanged = true;
               }
           }
        });
        mbeanDescriptionJTextField.setName("mbeanDescriptionJTextField");
        // init flags
        selectedMBeanType = mbeanType.StandardMBean;
        
        // init labels
        Mnemonics.setLocalizedText(generatedFileJLabel,
                     bundle.getString("LBL_mbean_other_created_interface"));//NOI18N
        Mnemonics.setLocalizedText(mbeanDecriptionJLabel,
                     bundle.getString("LBL_mbean_description"));//NOI18N
        Mnemonics.setLocalizedText(mbeanTypeJLabel,
                     bundle.getString("LBL_mbean_type"));//NOI18N
        Mnemonics.setLocalizedText(standardMBeanJRadioButton,
                     bundle.getString("LBL_standard_mbean_type"));//NOI18N
        Mnemonics.setLocalizedText(extendedMBeanJRadioButton,
                     bundle.getString("LBL_extended_standard_mbean_type"));//NOI18N
        Mnemonics.setLocalizedText(dynamicMBeanJRadioButton,
                     bundle.getString("LBL_dynamic_mbean_type"));//NOI18N
        
        // Provide a name in the title bar.
        setName(bundle.getString("LBL_Standard_Panel"));
    }
        
    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    // <editor-fold defaultstate="collapsed" desc=" Generated Code ">//GEN-BEGIN:initComponents
    private void initComponents() {
        java.awt.GridBagConstraints gridBagConstraints;

        mbeanTypeButtonGroup = new javax.swing.ButtonGroup();
        northCenterPanel = new javax.swing.JPanel();
        jSeparator1 = new javax.swing.JSeparator();
        mbeanDecriptionJLabel = new javax.swing.JLabel();
        mbeanDescriptionJTextField = new javax.swing.JTextField();
        generatedFileJLabel = new javax.swing.JLabel();
        generatedFileJTextField = new javax.swing.JTextField();
        mbeanTypeJLabel = new javax.swing.JLabel();
        standardMBeanJRadioButton = new javax.swing.JRadioButton();
        extendedMBeanJRadioButton = new javax.swing.JRadioButton();
        dynamicMBeanJRadioButton = new javax.swing.JRadioButton();

        setLayout(new java.awt.BorderLayout());

        setMinimumSize(new java.awt.Dimension(500, 500));
        setPreferredSize(new java.awt.Dimension(500, 500));
        northCenterPanel.setLayout(new java.awt.GridBagLayout());

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.gridwidth = java.awt.GridBagConstraints.REMAINDER;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(12, 0, 12, 0);
        northCenterPanel.add(jSeparator1, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(0, 0, 0, 12);
        northCenterPanel.add(mbeanDecriptionJLabel, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.gridwidth = java.awt.GridBagConstraints.REMAINDER;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        northCenterPanel.add(mbeanDescriptionJTextField, gridBagConstraints);

        generatedFileJLabel.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        generatedFileJLabel.setLabelFor(generatedFileJTextField);
        generatedFileJLabel.setMaximumSize(new java.awt.Dimension(1000, 1000));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(0, 0, 6, 12);
        northCenterPanel.add(generatedFileJLabel, gridBagConstraints);

        generatedFileJTextField.setEditable(false);
        generatedFileJTextField.setHorizontalAlignment(javax.swing.JTextField.LEFT);
        generatedFileJTextField.setName("generatedFileJTextField");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.gridwidth = java.awt.GridBagConstraints.REMAINDER;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(0, 0, 6, 0);
        northCenterPanel.add(generatedFileJTextField, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 3;
        gridBagConstraints.gridwidth = java.awt.GridBagConstraints.REMAINDER;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        northCenterPanel.add(mbeanTypeJLabel, gridBagConstraints);

        mbeanTypeButtonGroup.add(standardMBeanJRadioButton);
        standardMBeanJRadioButton.setSelected(true);
        standardMBeanJRadioButton.setName("StandardMBean");
        standardMBeanJRadioButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                standardMBeanJRadioButtonActionPerformed(evt);
            }
        });

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 4;
        gridBagConstraints.gridwidth = java.awt.GridBagConstraints.REMAINDER;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(0, 12, 0, 0);
        northCenterPanel.add(standardMBeanJRadioButton, gridBagConstraints);

        mbeanTypeButtonGroup.add(extendedMBeanJRadioButton);
        extendedMBeanJRadioButton.setName("ExtendedStandardMBean");
        extendedMBeanJRadioButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                extendedStandardMBeanJRadioButtonActionPerformed(evt);
            }
        });

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 5;
        gridBagConstraints.gridwidth = java.awt.GridBagConstraints.REMAINDER;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(0, 12, 0, 0);
        northCenterPanel.add(extendedMBeanJRadioButton, gridBagConstraints);

        mbeanTypeButtonGroup.add(dynamicMBeanJRadioButton);
        dynamicMBeanJRadioButton.setName("DynamicMBean");
        dynamicMBeanJRadioButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                dynamicMBeanJRadioButtonActionPerformed(evt);
            }
        });

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 6;
        gridBagConstraints.gridwidth = java.awt.GridBagConstraints.REMAINDER;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(0, 12, 0, 0);
        northCenterPanel.add(dynamicMBeanJRadioButton, gridBagConstraints);

        add(northCenterPanel, java.awt.BorderLayout.NORTH);

    }
    // </editor-fold>//GEN-END:initComponents

    private void dynamicMBeanJRadioButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_dynamicMBeanJRadioButtonActionPerformed
        wiz.storeSettings(wiz.templateWiz);
        wiz.readSettings(wiz.templateWiz);
        wiz.fireEvent();
    }//GEN-LAST:event_dynamicMBeanJRadioButtonActionPerformed

    private void extendedStandardMBeanJRadioButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_extendedStandardMBeanJRadioButtonActionPerformed
        wiz.storeSettings(wiz.templateWiz);
        wiz.readSettings(wiz.templateWiz);
        wiz.fireEvent();
    }//GEN-LAST:event_extendedStandardMBeanJRadioButtonActionPerformed

    private void standardMBeanJRadioButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_standardMBeanJRadioButtonActionPerformed
        wiz.storeSettings(wiz.templateWiz);
        wiz.readSettings(wiz.templateWiz);
        wiz.fireEvent();
    }//GEN-LAST:event_standardMBeanJRadioButtonActionPerformed
  
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JRadioButton dynamicMBeanJRadioButton;
    private javax.swing.JRadioButton extendedMBeanJRadioButton;
    private javax.swing.JLabel generatedFileJLabel;
    private javax.swing.JTextField generatedFileJTextField;
    private javax.swing.JSeparator jSeparator1;
    private javax.swing.JLabel mbeanDecriptionJLabel;
    private javax.swing.JTextField mbeanDescriptionJTextField;
    private javax.swing.ButtonGroup mbeanTypeButtonGroup;
    private javax.swing.JLabel mbeanTypeJLabel;
    private javax.swing.JPanel northCenterPanel;
    private javax.swing.JRadioButton standardMBeanJRadioButton;
    // End of variables declaration//GEN-END:variables
    
    /**
     *
     * Class handling the standard MBean wizard panel
     *
     */
    public static class StandardMBeanWizardPanel extends GenericWizardPanel
            implements org.openide.WizardDescriptor.FinishablePanel 
    {    
        private StandardMBeanPanel panel = null;
        private String projectLocation   = null;
        private ResourceBundle bundle = null;
        private TemplateWizard templateWiz = null;
        private JTextField mbeanNameTextField = null;
        private JTextField createdFileTextField = null;
        private JTextField projectTextField = null;
        private WizardDescriptor.Panel mbeanTargetWiz = null;
        
        /**
         * Constructor
         */
        public StandardMBeanWizardPanel() {
        }
        
        /**
         * Implementation of the FinishablePanel Interface; provides the Finish Button to be always enabled 
         * @return finish true if the panel can be the last one and enables the finish button
         */
        public boolean isFinishPanel() { return isValid();}
        
        /**
         * Method returning the corresponding panel; here the StandardMBeanPanel
         * @return panel the panel
         */
        public Component getComponent () { return getPanel(); }
        
        /**
         * Method returning the project location
         * @return projectLocation the project location
         */
        public String getProjectLocation() { return projectLocation; }
        
        private StandardMBeanPanel getPanel() 
        {
            if (panel == null) {
                panel = new StandardMBeanPanel(this);
            }
            return panel;
        }
        
        /**
         * Method which returns the mbean type which has been selected
         * Either Standard ExtendedStandard or Dynamic
         * @return mbeanType the mbean type
         */
        public mbeanType mbeanTypeSelected() {
            return getPanel().selectedMBeanType;
        }
        
        /**
         * Method which returns whether the description has changed or not
         * @return descHasChanged true if the description has changed
         */
        public boolean descHasChanged() {
            return getPanel().descHasChanged;
        }

        /**
         * Method which enables the next button
         * @return next true if the information in the panel is sufficient to go to the next step
         */
        public boolean isValid () {
            if (WizardHelpers.fileExists(
                    getPanel().generatedFileJTextField.getText())) {
                setErrorMsg("The file " + 
                        WizardHelpers.getFileName(
                            getPanel().generatedFileJTextField.getText()) +
                        " already exists.");
                return false;
            }
            return true;
        }
        
        /**
         * Displays the given message in the wizard's message area.
         *
         * @param  message  message to be displayed, or <code>null</code>
         *                  if the message area should be cleared
         */
        private void setErrorMsg(String message) {
            if (templateWiz != null) {
                templateWiz.putProperty(WizardConstants.WIZARD_ERROR_MESSAGE, 
                        message);    //NOI18N
            }
        }
        
        private String getProjectDisplayedName() {
            Project project = Templates.getProject(templateWiz);
            return ProjectUtils.getInformation(project).getDisplayName();
        }

        private void initTargetComponentDef(Component root) {
            if (root.getClass().equals(JTextField.class)) {
                JTextField rootTextField = (JTextField) root;
                if (rootTextField.isEditable()) {
                    mbeanNameTextField = ((JTextField) root);
                } else if (!rootTextField.getText().equals(getProjectDisplayedName())) {
                    if (projectTextField != null) {
                        createdFileTextField = ((JTextField) root);
                    }
                } else {
                    projectTextField = ((JTextField) root);
                }
            } else if ((root instanceof Container) && (root != getComponent())) {
                Component[] components = ((Container) root).getComponents();
                for (int i = 0; i < components.length; i++) {
                    initTargetComponentDef(components[i]);
                }
            }
        }
        
        /**
         * Method which fires an event to notify that there was a change in the data
         */
        public void fireEvent() {
            fireChangeEvent();
        }
        
        /**
         * Add a changeListener on the mbeanTargetWiz which each time that a change 
         * event happens, store and reload the mbeanOptionsWiz.
         * @param mbeanTargetWiz <CODE>Panel</CODE> 
         * @param mbeanOptionsWiz <CODE>Panel</CODE> 
         * @param wizard <CODE>WizardDescriptor</CODE> a wizard
         */
        public void setListenerEnabled(
                final WizardDescriptor.Panel mbeanTargetWiz,
                final WizardDescriptor.Panel mbeanOptionsWiz,
                final TemplateWizard wizard) {
            bundle = NbBundle.getBundle(JMXMBeanIterator.class);
            templateWiz = wizard;
            this.mbeanTargetWiz = mbeanTargetWiz;
            initTargetComponentDef(mbeanTargetWiz.getComponent());
            mbeanTargetWiz.addChangeListener(new ChangeListener() {
                public void stateChanged(ChangeEvent evt) {
                    mbeanOptionsWiz.storeSettings(wizard);
                    mbeanOptionsWiz.readSettings(wizard);
                    updateMBeanDesc(wizard);
                }
            });
        }
        
        private void updateMBeanDesc(TemplateWizard wizard) {
            if (!descHasChanged()) {
                String mbeanName = (String)
                        wizard.getProperty(WizardConstants.PROP_MBEAN_NAME);
                if ((mbeanName == null) || (mbeanName.equals(""))) {
                    mbeanName = "MBean";
                }
                String desc = mbeanName + WizardConstants.MBEAN_DESCR_DEFVALUE;
                getPanel().mbeanDescriptionJTextField.setText(desc);
            }
        }
        
        /**
         * Method which Called to read information from the wizard map in order to populate
         * the GUI correctly
         * @param settings the object containing the data
         */
        public void readSettings (Object settings) 
        {
            
            templateWiz = (TemplateWizard) settings;
            initTargetComponentDef(mbeanTargetWiz.getComponent());
            bundle = NbBundle.getBundle(JMXMBeanIterator.class);
            
            
            String clzz =  bundle.getString("LBL_mbean_other_created_class");
            String itf = bundle.getString("LBL_mbean_other_created_interface");
            String descr = bundle.getString("LBL_mbean_description");

            int maxWidth = 0;
            Mnemonics.setLocalizedText(getPanel().generatedFileJLabel, clzz);
            maxWidth = (int) getPanel().generatedFileJLabel.getSize().getWidth();
            Mnemonics.setLocalizedText(getPanel().generatedFileJLabel, itf);
            maxWidth = (int) getPanel().generatedFileJLabel.getSize().getWidth() > maxWidth ? (int) getPanel().generatedFileJLabel.getSize().getWidth() : maxWidth;
            maxWidth = (int) getPanel().mbeanDecriptionJLabel.getSize().getWidth() > maxWidth ? (int) getPanel().mbeanDecriptionJLabel.getSize().getWidth() : maxWidth;
            
            int maxHeight = 0;
            Mnemonics.setLocalizedText(getPanel().generatedFileJLabel, clzz);
            maxHeight = (int) getPanel().generatedFileJLabel.getSize().getHeight();
            Mnemonics.setLocalizedText(getPanel().generatedFileJLabel, itf);
            maxHeight = (int) getPanel().generatedFileJLabel.getSize().getHeight() > maxHeight ? (int) getPanel().generatedFileJLabel.getSize().getHeight() : maxHeight;
            maxHeight = (int) getPanel().mbeanDecriptionJLabel.getSize().getHeight() > maxHeight ? (int) getPanel().mbeanDecriptionJLabel.getSize().getHeight() : maxHeight;
            
            //The first time, the size is 0. We update size ONLY is maxSize != 0
            if(maxWidth != 0) {
                getPanel().generatedFileJLabel.setMinimumSize(new java.awt.Dimension(maxWidth, maxHeight));
                getPanel().generatedFileJLabel.setPreferredSize(new java.awt.Dimension(maxWidth, maxHeight));                
                getPanel().generatedFileJTextField.setMinimumSize(new java.awt.Dimension(maxWidth, maxHeight));
                getPanel().generatedFileJTextField.setPreferredSize(new java.awt.Dimension(maxWidth, maxHeight));                
                
                getPanel().mbeanDecriptionJLabel.setMinimumSize(new java.awt.Dimension(maxWidth, maxHeight));
                getPanel().mbeanDecriptionJLabel.setPreferredSize(new java.awt.Dimension(maxWidth, maxHeight));
                getPanel().mbeanDescriptionJTextField.setMinimumSize(new java.awt.Dimension(maxWidth, maxHeight));
                getPanel().mbeanDescriptionJTextField.setPreferredSize(new java.awt.Dimension(maxWidth, maxHeight));
            }
            
            // set tag for mbean type radio Button 
            String mbeanType = 
                    (String) templateWiz.getProperty(WizardConstants.PROP_MBEAN_TYPE);
            if (mbeanType != null) {
                getPanel().standardMBeanJRadioButton.setSelected(
                        mbeanType.equals(WizardConstants.MBEAN_STANDARDMBEAN));
                getPanel().extendedMBeanJRadioButton.setSelected(
                        mbeanType.equals(WizardConstants.MBEAN_EXTENDED));
                getPanel().dynamicMBeanJRadioButton.setSelected(
                        mbeanType.equals(WizardConstants.MBEAN_DYNAMICMBEAN));
            }
            
            String mbeanName = (String) 
                templateWiz.getProperty(WizardConstants.PROP_MBEAN_NAME);
            String mbeanFilePath = (String) 
                templateWiz.getProperty(WizardConstants.PROP_MBEAN_FILE_PATH);
            
            if ((mbeanName != null) && (mbeanFilePath != null)) {
                String suffix = null;
                
                if (getPanel().dynamicMBeanJRadioButton.isSelected()) {
                    suffix = WizardConstants.MBEAN_SUPPORT_SUFFIX;
                    Mnemonics.setLocalizedText(getPanel().generatedFileJLabel,
                     bundle.getString("LBL_mbean_other_created_class"));//NOI18N
                } else {
                    Mnemonics.setLocalizedText(getPanel().generatedFileJLabel,
                     bundle.getString("LBL_mbean_other_created_interface"));//NOI18N
                    suffix = WizardConstants.MBEAN_ITF_SUFFIX;
                }
                getPanel().generatedFileJTextField.setText(mbeanFilePath + 
                        File.separator + mbeanName +
                        suffix + "." + WizardConstants.JAVA_EXT);

            } else {
                getPanel().generatedFileJTextField.setText("");
            }
            
            
            String desc = (String) 
                templateWiz.getProperty (WizardConstants.PROP_MBEAN_DESCRIPTION);
            if (desc == null) {
                if (mbeanName == null) {
                    desc = "MBean" + WizardConstants.MBEAN_DESCR_DEFVALUE;
                } else {
                    desc = mbeanName + WizardConstants.MBEAN_DESCR_DEFVALUE;
                }
            } 
            getPanel().mbeanDescriptionJTextField.setText(desc);
            updateMBeanDesc(templateWiz);
        }
        
        /**
         * Method called to store information from the GUI into the wizard map
         * @param settings the object containing the data to store
         */
        public void storeSettings (Object settings) 
        {            
            TemplateWizard wiz = (TemplateWizard) settings;
            
            String mbeanName = mbeanNameTextField.getText();
            wiz.putProperty (WizardConstants.PROP_MBEAN_NAME, mbeanName);
            wiz.putProperty (WizardConstants.PROP_JUNIT_CLASSNAME, 
                    mbeanName + WizardConstants.JUNIT_TEST_SUFFIX);
            Project project = Templates.getProject(wiz);
            if (createdFileTextField != null) {
                String filePath = WizardHelpers.getFolderPath(
                        createdFileTextField.getText());
                String packName =
                        WizardHelpers.getPackageName(project,filePath);
                wiz.putProperty(WizardConstants.PROP_MBEAN_FILE_PATH,filePath);
                wiz.putProperty(WizardConstants.PROP_MBEAN_PACKAGE_NAME, packName);
                wiz.putProperty(WizardConstants.PROP_MBEAN_PACKAGE_PATH,
                        packName.replace('.', File.separatorChar));
            }
            // storage of the description field
            String description = getPanel().mbeanDescriptionJTextField.getText();
            if ( (description != null) && (!description.equals("")) ) {
                wiz.putProperty (WizardConstants.PROP_MBEAN_DESCRIPTION, 
                        description);
            } else {
                wiz.putProperty (WizardConstants.PROP_MBEAN_DESCRIPTION, "");
            }
            // store mbean type
            if (getPanel().standardMBeanJRadioButton.isSelected())  
                wiz.putProperty (WizardConstants.PROP_MBEAN_TYPE, 
                        WizardConstants.MBEAN_STANDARDMBEAN);
            else {
                if (getPanel().dynamicMBeanJRadioButton.isSelected())   
                    wiz.putProperty (WizardConstants.PROP_MBEAN_TYPE, 
                            WizardConstants.MBEAN_DYNAMICMBEAN);
                else { 
                    wiz.putProperty (WizardConstants.PROP_MBEAN_TYPE, 
                            WizardConstants.MBEAN_EXTENDED);
                }
            } 
            
        }    
        
        public HelpCtx getHelp() {
           return new HelpCtx("jmx_instrumenting_app");  
        } 
    }
}
