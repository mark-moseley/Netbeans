<?xml version="1.0" encoding="UTF-8"?>
<project basedir="." default="all" name="build-pes">

  <property name="build.sysclasspath" value="ignore"/>
  <property name="build.compiler.deprecation" value="off"/>    
  <property name="build.compiler.debug" value="on"/>

  <target name="init">
    <ant dir="../external" target="unscramble"/>
  </target>


  <target name="compile" depends="init">
      <!-- compile xtest first -> pes depends on several of its classes -->
      <javac srcdir="../src" destdir="src"
           deprecation="${build.compiler.deprecation}"
           debug="${build.compiler.debug}"> 
        <include name="org/netbeans/xtest/pe/**"/>
        <include name="org/netbeans/xtest/util/**"/>
        <include name="org/netbeans/xtest/xmlserializer/**"/>
        <classpath>	
          <fileset dir="../external">
            <include name="ant-1.*.jar"/>
          </fileset>
        </classpath>        
      </javac>     

      <javac srcdir="src" destdir="src"
           deprecation="${build.compiler.deprecation}"
           debug="${build.compiler.debug}"> 
        <classpath>		
          <fileset dir="../external">
            <include name="ant-1.*.jar"/>
          </fileset>
        </classpath>
      </javac>
  </target>
  
  <target name="jar" depends="compile">
    <mkdir dir="lib"/>    
    <filter token="BUILD_NUMBER_SUBST" value="${buildnumber}"/>
    <jar jarfile="lib/xtest-pes.jar"
            basedir="src"
            excludesfile="../../nbbuild/standard-jar-excludes.txt"
            compress="false"
            includes="org/netbeans/xtest/**"/>
  </target>
  
  <target name="build-pes" depends="jar">
     <!-- also copy stylesheets -->
     <copy todir="lib/xsl">
        <fileset dir="../lib/xsl"/>
     </copy>
  </target>
  
  <target name="makedist" depends="build-pes">
    <zip zipfile="xtest-pes-distribution.zip">
     	<zipfileset dir="lib" prefix="lib" includes="**/*.jar,**/*.xsl"/>
     	<zipfileset dir="bin" prefix="bin" includes="xtest-pes.sh"/>
     	<zipfileset  dir="../external/" prefix="lib" includes="ant-1.4.1.jar"/>
     </zip>  
  </target>
  
  <target name="clean">
    <delete>
      <fileset dir="src">
        <include name="**/*.class"/>
      </fileset>
    </delete>
    <delete dir="lib"/>
    <delete file="xtest-pes-distribution.zip"/>
  </target>  
  

</project>
