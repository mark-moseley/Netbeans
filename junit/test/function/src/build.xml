<?xml version="1.0" encoding="UTF-8"?>
<project basedir=".." default="netbeans" name="MyModule_test">

    <property name="binroot" value="../../.." />

    <property name="xtest.home" value="../../../xtest" />
    <property name="netbeans.test.home" value="${netbeans.home}" />

    <taskdef classname="org.netbeans.xtest.NbPath" classpath="${xtest.home}/lib/xtest.jar" name="nbpath"/>
    <taskdef classname="org.netbeans.xtest.XalanLauncher" classpath="${xtest.home}/lib/xtest.jar" name="xalan"/>

    <!-- test execution -->
    <target name="test_all">
        <ant antfile="src/test.xml" target="testAll">
            <property name="test_type" value="code"/>
        </ant>
    </target>

    <target name="test_code">
        <ant antfile="src/test.xml">
            <property name="test_type" value="code"/>
        </ant>
    </target>

    <target name="test_ins">
        <ant antfile="src/test.xml">
            <property name="test_type" value="ins"/>
        </ant>
    </target>

    <target name="test_ide">
        <ant antfile="src/test.xml">
            <property name="test_type" value="ide"/>
        </ant>
    </target>

    <!-- test building -->
    <target name="build_test">
        <mkdir dir="results" />
        <xalan srcfile="src/test.def" trgfile="src/test.xml" xslt="${xtest.home}/xslt/FunTest2build.xsl"/> 
        <xalan srcfile="src/test.def" trgfile="results/index.xml" xslt="${xtest.home}/xslt/test2index.xsl"/>
        <ant antfile="src/test.xml" target="testAll">
            <property name="test_type" value="empty"/>
        </ant>
        <xalan xslt="${xtest.home}/xslt/FunTestIndex2html.xsl" srcfile="results/index.xml" trgfile="results/index.html" />
    </target>

    <!-- test compilation & packaging -->
    <target name="compile">
        <javac destdir="src" srcdir="src">
            <classpath>
                <pathelement location="../../src"/>
	        <pathelement location="../../../openide/openide-13javac-workaround.jar"/>
                <fileset dir="../../../openide/netbeans/lib">
                    <include name="openide*.jar" />
                </fileset>
                <pathelement location="../../../java/netbeans/modules/java.jar"/>
                <pathelement location="${xtest.home}/lib/xtest.jar"/>
                <pathelement location="${binroot}/core/release/lib/ext/junit.jar"/>
            </classpath>
        </javac>
    </target>

    <target depends="compile" name="jars">
        <mkdir dir="lib"/>
        <jar basedir="src" compress="false" excludesfile="../../../nbbuild/standard-jar-excludes.txt" jarfile="lib/test.jar">
        </jar>
    </target>

    <target depends="jars, build_test, test_code" name="netbeans"/>

    <!-- cleanup -->
    <target name="clean">
        <delete>
            <fileset dir="src">
                <include name="**/*.class"/>
            </fileset>
        </delete>
        <delete dir="lib"/>
        <delete dir="results"/>
    </target>

</project>
