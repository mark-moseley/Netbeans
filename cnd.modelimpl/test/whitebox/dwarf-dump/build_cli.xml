<?xml version='1.0' encoding='ISO-8859-1' ?>

<project name="DwarfDump" default="jar" basedir=".">
    <property name="project.ModelUtils" value="../dm-utils"/>

    <property name="module-jar-name" value="DwarfDump.jar"/>
    <property name="src.dir" value="./src"/>
    <property name="build.dir" value="./build"/>
    <property name="dist.dir" value="./dist"/>
    <property name="classes.dir" value="./build/classes"/>
    <property name="build.compiler.debug" value="yes"/>


    <property name="args" value=""/>
    <property name="test.dir" value="."/>
    <property name="main.class" value="test.dwarfdump.DwarfDump"/>

    <target name="deps-clean">
        <ant target="clean" inheritall="false" antfile="${project.ModelUtils}/build_cli.xml"/>
    </target>

    <target name="clean" depends="deps-clean">
        <delete dir="${classes.dir}"/>
        <delete dir="${build.dir}"/>
        <delete dir="${dist.dir}"/>
    </target>

    <target name="deps-jar">
        <ant target="jar" inheritall="false" antfile="${project.ModelUtils}/build_cli.xml"/>
    </target>


    <target name="jar" depends="deps-jar, compile">
        <mkdir dir="${dist.dir}"/>
        <jar jarfile="${dist.dir}/${module-jar-name}"
                        basedir="${src.dir}"
                        compress="false">
                        <fileset dir="${build.dir}/classes" />
                        <fileset dir="${src.dir}"
                                includes="**/META-INF/**, **/resources/**, **/Bundle.properties, **/*.gif"
                        />
        </jar>
    </target>

    <target name="compile">
                <mkdir dir="${classes.dir}" />
                <javac
                        srcdir="${src.dir}"
                        source="1.5"
                        destdir="${classes.dir}"
                        deprecation="${build.compiler.deprecation}"
                        debug="${build.compiler.debug}"
                        excludes="**/SCCS/*.java" >
                        <classpath>
                                <pathelement location="${project.ModelUtils}/dist/ModelUtils.jar"/>
                        </classpath>
                </javac>
    </target>

    <target name="run" depends="jar">
        <echo message="Running ${main.class} with parameters ${args}"/>
        <java
            classname="${main.class}"
            fork="true"
            dir="${test.dir}">
            <classpath>
                <pathelement location="${dist.dir}/${module-jar-name}"/>
                <pathelement location="${project.ModelUtils}/dist/ModelUtils.jar"/>
            </classpath>
            <arg line="${args}"/>
        </java>
    </target>


</project>

