<project name="php/srcmodel/test" basedir="." default="all">

    <!-- Name of tested module -->
    <property name="xtest.module" value="php"/>
 
    <!-- Imports buildtests, cleantests, runtest, cleanresults, realclean, printconfig targets. -->
    <import file="../../../nbbuild/templates/xtest.xml"/>

    <property file="./config.properties"/>


    <property name="netbeans.dest.dir" location="../../../nbbuild/netbeans/"/>


    <!-- default testtypes, attributes used when no value is supplied from command line -->
    <property name="xtest.testtype" value="unit"/>
    <property name="xtest.attribs" value="ide"/>


    <taskdef name="getResults" classname="org.netbeans.xtest.pe.GetResultsTask" classpath="${xtest.home}/lib/xtest.jar"/>


    <target name="unit-test">

       <java classname="util.date.DateUtil" outputproperty="time.current">
          <classpath> <pathelement location="./lib/util-date.jar"/> </classpath>
       </java>

	<echo message="current time [${time.current}]"/>
 

	<property name="junit.results" value="${junit.results.dir}/${time.current}"/>
	<property name="junit.temp.results" value="${junit.results}/temp"/>



   	<antcall target="junit">  <param name="project.dir" value="project"/> </antcall>


	  <junitreport todir="${junit.results}">

	    <fileset dir="${junit.temp.results}">
	      <include name="TEST-*.xml" />
	    </fileset>

    	    <report format="frames" todir="${junit.results}"/>

	  </junitreport>

    </target>


    <target name="junit">
        <subant target="test" inheritAll="false" failonerror="false">
            <buildpath location="../${project.dir}"/>
        </subant>

        <copy todir="${junit.temp.results}">
	    <fileset dir="../${project.dir}/build/test/unit/results"/>
	</copy>

    </target>

    <property name="xtest.mail.mailhost" value="localhost"/>

    <!--property name="xtest.mail.report" value="./report.txt"/-->
    <!--property name="xtest.mail.mailhost" value="localhost"/-->

    <property name="xtest.mail.from" value="mikhailmatveev@netbeans.org"/>
    <property name="xtest.mail.to" value="mikhailmatveev@netbeans.org"/>
    <property name="summary" value="PHP Unit Tests"/>


    <target name="send-mail">
	<clover-report/>

    	<getResults resultsDir="${junit.results.dir}" summaryProperty="summary" 
                    onlyWhenFailed="false"  
                    mailReportProperty="xtest.mail.report"/> 

        <mail from="${xtest.mail.from}" tolist="${xtest.mail.to}" 
              subject="XTest Results: ${summary}" messagefile="${xtest.mail.report}"
              mailhost="${xtest.mail.mailhost}"/>     

    </target>    



</project>