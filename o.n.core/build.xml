<?xml version='1.0' encoding='ISO-8859-1' ?>
<!--
                Sun Public License Notice

The contents of this file are subject to the Sun Public License
Version 1.0 (the "License"). You may not use this file except in
compliance with the License. A copy of the License is available at
http://www.sun.com/

The Original Code is NetBeans. The Initial Developer of the Original
Code is Sun Microsystems, Inc. Portions Copyright 1997-2000 Sun
Microsystems, Inc. All Rights Reserved.
-->

<project name="core" default="nbm" basedir=".">
  <target name="compile">
    <!-- Force use of classic compiler, though slower; modern compiler on Linux 1.3 -->
    <!-- has bugs which prevents it from compiling entire module correctly -->
    <!-- (though compiling in pieces *sometimes* works). -->
    <!-- XXX Apparently Win2000 1.3 can compile it with modern compiler, so make this -->
    <!-- test conditional on Linux, to avoid penalizing others with a slow compiler. -->
    <!-- Also see same situation in beans and form modules. -->
    <ant dir="../core" target="compile-with-classic-Javac">
      <property name="build.compiler" value="classic"/>
    </ant>
    <javac srcdir="libsrc" destdir="libsrc"/>
  </target>
  <target name="compile-with-classic-Javac">
    <javac srcdir="src" destdir="src">
      <classpath>
        <!-- XXX This should be fixed, possibly TopSecurityManager -->
	<!-- cannot even access ICE Browser classes at runtime: -->
        <pathelement location="../icebrowser/release/modules/ext/icebrowserlitebean.jar"/>
        <pathelement location="../openide/netbeans/lib/openide.jar"/>
	<pathelement location="release/lib/ext/regexp.jar"/>
	<pathelement location="release/lib/ext/jaxp.jar"/>
	<pathelement location="release/lib/ext/parser.jar"/>
	<pathelement location="release/lib/ext/jh.jar"/>
      </classpath>
    </javac>
  </target>
  <target name="tojar">
    <taskdef name="tojar" classname="org.netbeans.nbbuild.ToJar"/>
    <tojar srcdir="src" unpackeddir="tojar"/>
  </target>
  <target name="jars" depends="compile,tojar">
    <mkdir dir="netbeans/lib/ext"/>
    <!-- Hack to subst a key in Versioning.properties, but not permanently change it: -->
    <rename src="src/org/netbeans/core/Versioning.properties"
           dest="src/org/netbeans/core/Versioning.properties-"/>
    <filter token="BUILD_NUMBER_SUBST" value="${buildnumber}"/>
    <copyfile src="src/org/netbeans/core/Versioning.properties-"
             dest="src/org/netbeans/core/Versioning.properties"
	     filtering="on"/>
    <jar jarfile="netbeans/lib/developer.jar"
         basedir="src"
	 excludesfile="../nbbuild/standard-jar-excludes.txt"
	 compress="false">
      <exclude name="**/org/netbeans/core/Versioning.properties-"/>
    </jar>
    <rename src="src/org/netbeans/core/Versioning.properties-"
           dest="src/org/netbeans/core/Versioning.properties"/>
    <!-- XXX does this really need to be built? -->
    <jar jarfile="netbeans/lib/ext/regexp.jar"
         basedir="libsrc"
	 excludesfile="../nbbuild/standard-jar-excludes.txt"
	 compress="false"/>
  </target>
  <target name="release">
    <copydir src="release" dest="netbeans">
      <exclude name="**/lib/ext/regexp.jar"/>
    </copydir>
  </target>
  <target name="nbm" depends="jars,release">
    <zip zipfile="core.nbm" includes="netbeans/" basedir="."/>
  </target>
  <target name="clean">
    <delete dir="src">
      <include name="**/*.class"/>
      <include name="**/*.jar"/>
    </delete>
    <delete dir="libsrc">
      <include name="**/*.class"/>
    </delete>
    <delete file="core.nbm"/>
    <deltree dir="netbeans"/>
  </target>
</project>
