<?xml version="1.0" encoding="UTF-8"?> <!-- -*- sgml-indent-step: 2 -*- -->
<!--
                Sun Public License Notice

The contents of this file are subject to the Sun Public License
Version 1.0 (the "License"). You may not use this file except in
compliance with the License. A copy of the License is available at
http://www.sun.com/

The Original Code is NetBeans. The Initial Developer of the Original
Code is Sun Microsystems, Inc. Portions Copyright 1997-2003 Sun
Microsystems, Inc. All Rights Reserved.
-->

<!--
ToDo:
- build validator DTD for this build system
- sanity check that module list actually satisfies module dependencies
-->

<project name="nbbuild" default="all" basedir=".">

  <!-- First things first: read the user's and/or -->
  <!-- the site's build properties files.         -->
  <property file="user.build.properties"/>
  <property file="site.build.properties"/>

  <!-- Now read the standard properties file. -->
  <property file="build.properties"/>

  <property name="build.sysclasspath" value="ignore"/>

  <!-- To make people happy who want to do `ant clean all': -->
  <target name="all" depends="build,commit-validation" description="Build the IDE and run basic validation tests."/>

  <target name="all-nozip" depends="build-nozip,commit-validation" description="Build the IDE (no ZIP file, unpacked) and run basic validation tests."/>

  <target name="check-for-jdk-1.4">
    <available property="have-jdk-1.4" classname="java.lang.CharSequence"/>
  </target>
  <target name="assure-jdk-1.4" depends="check-for-jdk-1.4" unless="have-jdk-1.4">
    <fail>You need JDK 1.4 or higher to build NetBeans.</fail>
  </target>

  <target name="bootstrap"
          description="Bootstrap NetBeans-specific Ant extensions."
          depends="assure-jdk-1.4">
    <echo message="Bootstrapping NetBeans-specific Ant extensions..."/>
    <ant dir="external" target="unscramble"/>
    <ant dir="../core/external" target="unscramble"/>
    <ant dir="../libs/external" target="unscramble"/>
    <ant dir="../xml/external" target="unscramble"/>
    <path id="bootstrap-cp">
     <!-- cmdline Ant -->
     <pathelement location="${ant.home}/lib/ant.jar"/>
     <!-- Ant in NB -->
     <pathelement path="${netbeans.library.path}"/>
     <fileset dir="..">
        <!-- XML Serializer: -->
        <include name="libs/external/xerces*.jar"/>
        <!-- Needed for CheckLinks: -->
        <include name="libs/external/regexp*.jar"/>
        <!-- For JavaHelp indexing: -->
        <include name="nbbuild/external/jhall*.jar"/>
        <!-- For XMLValidate Ant task: -->
        <include name="xml/external/resolver*.jar"/>
      </fileset>
    </path>
    <javac srcdir="antsrc" destdir="antsrc" deprecation="${build.compiler.deprecation}" debug="${build.compiler.debug}">
      <classpath refid="bootstrap-cp"/>
    </javac>
    <jar jarfile="nbantext.jar" basedir="antsrc">
      <exclude name="**/*.java"/>
      <exclude name="package-list"/>
    </jar>
  </target>

  <target name="setup-jdkhome-1">
    <!-- Note: user-configured -Djavahome=... will always override this: -->
    <property name="javahome" location="${java.home}"/>
    <available property="javahome-valid" file="${javahome}/lib/tools.jar"/>
  </target>
  <target name="setup-jdkhome-2" depends="setup-jdkhome-1" if="javahome-valid">
    <property name="jdkhome" value="${javahome}"/>
    <property name="jdkhome-valid" value="true"/>
  </target>
  <target name="setup-jdkhome-3" depends="setup-jdkhome-1" unless="javahome-valid">
    <property name="jdkhome" location="${javahome}/.."/>
    <available property="jdkhome-valid" file="${jdkhome}/lib/tools.jar"/>
  </target>
  <target name="setup-jdkhome-4" depends="setup-jdkhome-2,setup-jdkhome-3" unless="jdkhome-valid">
    <fail message="No tools.jar found in ${javahome}! Set -Djavahome=... as needed."/>
  </target>

  <target name="init-module-list" depends="bootstrap,setup-jdkhome-4">
    <!-- Already read the user, site and standard properties files. -->

    <!-- Define modules. -->
    <!-- The following is not permitted by Ant: -->
    <!-- <property name="modules" value="${config.modules.${moduleconfig}}"/> -->
    <!-- So this is a little trick to do it anyway. -->
    <echo file="moduledefs-tmp.properties">modules=$${config.modules.${moduleconfig}}
fixedmodules=$${config.fixedmodules.${moduleconfig}}
</echo>
    <property file="moduledefs-tmp.properties"/>
    <property name="allmodules" value="${fixedmodules},${modules}"/>
  </target>

  <target name="check-whether-to-pre-unscramble" depends="init-module-list">
    <property name="moduleconfig-is-${moduleconfig}" value="true"/>
  </target>
  <target name="maybe-pre-unscramble" depends="check-whether-to-pre-unscramble" if="moduleconfig-is-stable" unless="netbeans.no.pre.unscramble">
    <!-- To make things more pleasant for the user, unscramble standard modules now. -->
    <!-- Otherwise the user would be prompted at intervals and it would get annoying. -->
    <!-- bootstrap already did core, nbbuild, xml -->
    <echo>About to unscramble additional third-party files you will probably need.
If you do not plan to use them and wish to avoid accepting their licenses,
try building with the flag: -Dnetbeans.no.pre.unscramble=true</echo>
    <ant dir="../ant/external" target="unscramble"/>
    <ant dir="../httpserver/external" target="unscramble"/>
    <ant dir="../java/external" target="unscramble"/>
    <ant dir="../libs/external" target="unscramble"/>
    <ant dir="../tomcatint/external" target="unscramble"/>
    <ant dir="../web/external" target="unscramble"/>
    <ant dir="../xml/external" target="unscramble"/>
  </target>

  <target name="set-buildnumber" unless="buildnumber">
    <tstamp>
    	<format property="buildnumber" pattern="yyMMdd"/>
    </tstamp>
  </target>

  <target name="init" depends="init-module-list,maybe-pre-unscramble,set-buildnumber">
    <taskdef name="cleanall" classname="org.netbeans.nbbuild.CleanAll" classpath="nbantext.jar"/>
    <taskdef name="nbmerge" classname="org.netbeans.nbbuild.NbMerge" classpath="nbantext.jar"/>
    <taskdef name="for-each" classname="org.netbeans.nbbuild.ForEach" classpath="nbantext.jar"/>

    <!-- We need absolute path to ${netbeans.dest} -->
    <property name="netbeans.dest.abs" location="${netbeans.dest}"/>
    <!-- Overridable. Note: need not necessarily be a number at all): -->
    <property name="buildnum" value="dev-${buildnumber}"/>
    <property name="sanitystart.args" value="-J-Dnetbeans.close=true ${sanitystart.args.additional}"/>

  </target>

  <!-- How to build the IDE core: -->
  <target name="all-openide" depends="init">
    <echo message="Building Open APIs..."/>
    <ant dir="../openide" target="netbeans"/>
  </target>
  <target name="all-openide/deprecated" depends="all-openide,all-java/srcmodel,all-debuggercore/oldapi,all-openide/compiler,all-openide/io,all-openide/execution">
    <echo message="Building openide/deprecated..."/>
    <ant dir="../openide/deprecated" target="netbeans"/>
  </target>
  <target name="all-openide/loaders" depends="all-openide">
    <echo message="Building openide/loaders..."/>
    <ant dir="../openide/loaders" target="netbeans"/>
  </target>
  <target name="all-openide/compiler" depends="all-openide,all-openide/io,all-openide/execution">
    <echo message="Building openide/compiler..."/>
    <ant dir="../openide/compiler" target="netbeans"/>
  </target>
  <target name="all-openide/execution" depends="all-openide,all-openide/io,all-openide/loaders">
    <echo message="Building openide/execution..."/>
    <ant dir="../openide/execution" target="netbeans"/>
  </target>
  <target name="all-openide/io" depends="all-openide">
    <echo message="Building openide/io..."/>
    <ant dir="../openide/io" target="netbeans"/>
  </target>
  <target name="all-core/deprecated" depends="all-openide/deprecated,all-core,all-openide/execution">
    <echo message="Building core/deprecated..."/>
    <ant dir="../core/deprecated" target="netbeans"/>
  </target>
  <target name="all-java/srcmodel" depends="all-openide,all-openide/loaders">
    <echo message="Building java/srcmodel..."/>
    <ant dir="../java/srcmodel" target="netbeans"/>
  </target>
  <target name="all-core" depends="all-openide,all-openide/loaders">
    <echo message="Building IDE core implementation..."/>
    <ant dir="../core" target="netbeans"/>
  </target>
  <target name="all-core/javahelp" depends="all-openide">
    <echo message="Building module core/javahelp..."/>
    <ant dir="../core/javahelp" target="netbeans"/>
  </target>
  <target name="all-core/compiler" depends="all-openide,all-core,all-openide/compiler,all-openide/io,all-core/output">
    <echo message="Building module core/compiler..."/>
    <ant dir="../core/compiler" target="netbeans"/>
  </target>
  <target name="all-core/execution" depends="all-openide,all-openide/io,all-openide/execution,all-core">
    <echo message="Building module core/execution..."/>
    <ant dir="../core/execution" target="netbeans"/>
  </target>
  <target name="all-core/output" depends="all-openide,all-openide/io,all-core,all-core/term">
    <echo message="Building module core/output..."/>
    <ant dir="../core/output" target="netbeans"/>
  </target>
  <target name="all-core/term" depends="init">
    <echo message="Building module core/term..."/>
    <ant dir="../core/term" target="netbeans"/>
  </target>
  <target name="all-core/ui" depends="all-openide,all-core">
    <echo message="Building module core/ui..."/>
    <ant dir="../core/ui" target="netbeans"/>
  </target>
  <target name="all-core/naming" depends="all-openide">
    <echo message="Building module core/naming..."/>
    <ant dir="../core/naming" target="netbeans"/>
  </target>
  <target name="all-core/windows" depends="all-openide,all-openide/loaders,all-core">
    <echo message="Building module core/windows..."/>
    <ant dir="../core/windows" target="netbeans"/>
  </target>
  <target name="all-core/ide" depends="all-openide">
    <echo message="Building module core/ide..."/>
    <ant dir="../core/ide" target="netbeans"/>
  </target>
  <target name="all-core/settings" depends="all-openide">
    <echo message="Building module core/settings..."/>
    <ant dir="../core/settings" target="netbeans"/>
  </target>
  <target name="all-openide/looks" depends="all-openide,all-openide/registry,all-core/registry">
    <echo message="Building module openide/looks..."/>
    <ant dir="../openide/looks" target="netbeans"/>
  </target>
  <target name="all-openide/registry" depends="all-openide">
    <echo message="Building module openide/registry..."/>
    <ant dir="../openide/registry" target="netbeans"/>
  </target>
  <target name="all-core/registry" depends="all-openide,all-openide/registry,all-openide/loaders,all-core">
    <echo message="Building module core/registry..."/>
    <ant dir="../core/registry" target="netbeans"/>
  </target>

  <!-- And the modules: -->
  <target name="all-ant" depends="all-openide,all-core/javahelp,all-openide/deprecated,all-openide/compiler,all-openide/execution,all-openide/io">
    <echo message="Building module ant..."/>
    <ant dir="../ant" target="netbeans"/>
  </target>
  <target name="all-ant/docs" depends="all-openide">
    <echo message="Building module ant/docs..."/>
    <ant dir="../ant/docs" target="netbeans"/>
  </target>
  <target name="all-ant/grammar" depends="all-openide,all-ant,all-xml/core">
    <echo message="Building module ant/grammar..."/>
    <ant dir="../ant/grammar" target="netbeans"/>
  </target>
  <target name="all-apisupport" depends="all-openide,all-core,all-core/javahelp,all-jarpackager,all-apisupport/lite,all-java/api,all-openide/deprecated,all-java/srcmodel,all-openide/compiler,all-openide/execution,all-openide/io">
    <echo message="Building module apisupport..."/>
    <ant dir="../apisupport" target="netbeans"/>
  </target>
  <target name="all-apisupport/ant" depends="all-openide,all-core,all-ant">
    <echo message="Building module apisupport/ant..."/>
    <ant dir="../apisupport/ant" target="netbeans"/>
  </target>
  <target name="all-apisupport/apidocs" depends="init,makeparserdb-modules">
    <echo message="Building module apisupport/apidocs..."/>
    <ant dir="../apisupport/apidocs" target="netbeans"/>
  </target>
  <target name="all-apisupport/lite" depends="all-openide,all-core,all-jarpackager,all-java/srcmodel,all-openide/execution">
    <echo message="Building module apisupport lite..."/>
    <ant dir="../apisupport/lite" target="netbeans"/>
  </target>
  <target name="all-applet" depends="all-openide,all-debuggercore,all-java/srcmodel,all-openide/compiler,all-openide/execution,all-debuggercore/oldapi">
    <echo message="Building module applet..."/>
    <ant dir="../applet" target="netbeans"/>
  </target>
  <target name="all-autoupdate" depends="all-openide,all-core">
    <echo message="Building module autoupdate..."/>
    <ant dir="../autoupdate" target="netbeans"/>
  </target>
  <target name="all-beans" depends="all-openide,all-java,all-java/srcmodel">
    <echo message="Building module beans..."/>
    <ant dir="../beans" target="netbeans"/>
  </target>
  <target name="all-classfile" depends="all-openide">
    <echo message="Building module classfile..."/>
    <ant dir="../classfile" target="netbeans"/>
  </target>
  <target name="all-classclosure" depends="all-openide,all-classfile,all-logger,all-java/srcmodel,all-openide/compiler">
    <echo message="Building module classclosure..."/>
    <ant dir="../classclosure" target="netbeans"/>
  </target>
  <target name="all-clazz" depends="all-openide,all-classfile,all-java/srcmodel,all-openide/execution,all-debuggercore/oldapi">
    <echo message="Building module clazz..."/>
    <ant dir="../clazz" target="netbeans"/>
  </target>
  <target name="all-db" depends="all-openide,all-openidex,all-form,all-openide/io">
    <echo message="Building module db..."/>
    <ant dir="../db" target="netbeans"/>
  </target>
  <target name="all-debuggercore/oldapi" depends="all-openide,all-java/srcmodel,all-openide/execution,all-openide/compiler,all-core">
    <echo message="Building module debuggercore/oldapi..."/>
    <ant dir="../debuggercore/oldapi" target="netbeans"/>
  </target>
  <target name="all-debuggercore" depends="all-openide,all-openide/deprecated,all-java/srcmodel,all-openide/compiler,all-openide/execution,all-openide/io,all-debuggercore/oldapi">
    <echo message="Building module debuggercore..."/>
    <ant dir="../debuggercore" target="netbeans"/>
  </target>
  <target name="all-debuggerjpda" depends="all-openide,all-debuggercore,all-openide/deprecated,all-java/srcmodel,all-openide/compiler,all-openide/execution,all-openide/io,all-debuggercore/oldapi">
    <echo message="Building module debuggerjpda..."/>
    <ant dir="../debuggerjpda" target="netbeans"/>
  </target>
  <target name="all-debuggertools" depends="all-openide,all-debuggercore,all-openide/io,all-openide/execution">
    <echo message="Building module debuggertools..."/>
    <ant dir="../debuggertools" target="netbeans"/>
  </target>
  <!-- XXX illegal dependence on core! -->
  <target name="all-editor" depends="all-openide,all-core,all-openide/deprecated,all-java/srcmodel,all-debuggercore/oldapi">
    <echo message="Building module editor..."/>
    <ant dir="../editor" target="netbeans"/>
  </target>
  <target name="all-diff" depends="all-openide,all-editor,all-openide/deprecated">
    <echo message="Building module diff..."/>
    <ant dir="../diff" target="netbeans"/>
  </target>
  <target name="all-extbrowser" depends="all-openide,all-openide/execution">
    <echo message="Building module extbrowser..."/>
    <ant dir="../extbrowser" target="netbeans"/>
  </target>
  <target name="all-extbrowser/webclient" depends="all-openide,all-httpserver">
    <echo message="Building module webclient..."/>
    <ant dir="../extbrowser/webclient" target="netbeans"/>
  </target>
  <target name="all-form" depends="all-openide,all-java,all-java/srcmodel,all-java/api,all-openide/compiler,all-openide/execution">
    <echo message="Building module form..."/>
    <ant dir="../form" target="netbeans"/>
  </target>
  <target name="all-freestylebrowser" depends="all-openide,all-openidex,all-beans,all-java,all-clazz">
    <echo message="Building module freestylebrowser..."/>
    <ant dir="../freestylebrowser" target="netbeans"/>
  </target>
  <target name="all-html" depends="all-openide ">
    <echo message="Building module html..."/>
    <ant dir="../html" target="netbeans"/>
  </target>
  <target name="all-httpserver" depends="all-openide, all-httpserver/servletapi">
    <echo message="Building module httpserver..."/>
    <ant dir="../httpserver" target="netbeans"/>
  </target>
  <target name="all-httpserver/servletapi" depends="all-openide">
    <echo message="Building module httpserver/servletapi..."/>
    <ant dir="../httpserver/servletapi" target="netbeans"/>
  </target>
  <target name="all-i18n" depends="all-openide,all-core,all-properties,all-form,all-openide/deprecated,all-java/srcmodel,all-openide/execution">
    <echo message="Building module i18n..."/>
    <ant dir="../i18n" target="netbeans"/>
  </target>
  <target name="all-itutor" depends="all-openide,all-core">
    <echo message="Building module itutor..."/>
    <ant dir="../itutor" target="netbeans"/>
  </target>
  <target name="all-icebrowser" depends="all-openide">
    <echo message="Building module icebrowser..."/>
    <ant dir="../icebrowser" target="netbeans"/>
  </target>
  <target name="all-image" depends="all-openide,all-openide/deprecated">
    <echo message="Building module image..."/>
    <ant dir="../image" target="netbeans"/>
  </target>
  <target name="all-innertesters" depends="all-openide,all-openide/execution,all-openide/compiler,all-openide/deprecated">
    <echo message="Building module innertesters..."/>
    <ant dir="../innertesters" target="netbeans"/>
  </target>
  <target name="all-j2eeserver/deprecated" depends="all-openide,all-jarpackager,all-debuggercore,all-debuggerjpda,all-openide/deprecated,all-java/srcmodel,all-openide/compiler,all-openide/execution,all-openide/io,all-debuggercore/oldapi">
    <echo message="Building module j2eeserver(deprecated)..."/>
    <ant dir="../j2eeserver/deprecated" target="netbeans"/>
  </target>
  <target name="all-j2eeserver" depends="all-openide,all-schema2beans,all-debuggercore,all-debuggerjpda,all-openide/deprecated,all-java/srcmodel,all-openide/compiler,all-openide/execution,all-openide/io,all-debuggercore/oldapi">
    <echo message="Building module j2eeserver..."/>
    <ant dir="../j2eeserver" target="netbeans"/>
  </target>
  <target name="all-junit" depends="all-openide,all-openide/deprecated,all-openide/compiler,all-openide/execution,all-openide/io,all-java/srcmodel">
    <echo message="Building module junit..."/>
    <ant dir="../junit" target="netbeans"/>
  </target>
  <target name="all-jarpackager" depends="all-openide,all-openide/deprecated,all-java/srcmodel,all-openide/compiler,all-openide/execution,all-openide/io">
    <echo message="Building module jarpackager..."/>
    <ant dir="../jarpackager" target="netbeans"/>
  </target>
  <target name="all-java" depends="all-openide,all-java/api,all-classfile,all-java/srcmodel,all-openide/compiler,all-openide/execution,all-debuggercore/oldapi">
    <echo message="Building module java..."/>
    <ant dir="../java" target="netbeans"/>
  </target>
  <target name="all-java/fastjavac" depends="all-openide,all-openide/compiler,all-openide/execution,all-java">
    <echo message="Building module java/fastjavac..."/>
    <ant dir="../java/fastjavac" target="netbeans"/>
  </target>
  <target name="all-java/api" depends="all-openide,all-openide/execution,all-openide/io">
    <echo message="Building Java support APIs.."/>
    <ant dir="../java/api" target="netbeans"/>
  </target>
  <target name="all-javadoc" depends="all-openide,all-java,all-core/javahelp,all-java/srcmodel,all-openide/execution,all-openide/io">
    <echo message="Building module javadoc..."/>
    <ant dir="../javadoc" target="netbeans"/>
  </target>
  <!--
  <target name="all-javaembeddedserver" depends="all-openide,all-jarpackager,all-form">
    <echo message="Building module javaembeddedserver..."/>
    <ant dir="../javaembeddedserver" target="netbeans"/>
  </target>
  -->
  <target name="all-jellytools" depends="all-openide,all-openide/loaders,all-core,all-core/term,all-jemmy,all-xtest,all-classfile,all-java,all-java/api,all-editor,all-java/srcmodel,all-openide/deprecated,all-core/deprecated,all-core/windows,all-core/execution,all-core/compiler">
    <echo message="Building module jellytools..."/>
    <ant dir="../jellytools" target="netbeans"/>
  </target>
  <target name="all-jemmy" depends="all-openide,all-core,all-classfile,all-java,all-java/api,all-editor,all-java/srcmodel,all-openide/deprecated,all-core/deprecated,all-core/windows,all-core/execution,all-core/compiler">
    <echo message="Building module jemmy..."/>
    <ant dir="../jemmy" target="netbeans"/>
  </target>
  <target name="all-jemmysupport" depends="all-openide,all-openide/execution,all-jemmy,all-diff">
    <echo message="Building module jemmysupport..."/>
    <ant dir="../jemmysupport" target="netbeans"/>
  </target>
  <target name="all-jini" depends="all-openide,all-httpserver">
    <echo message="Building module jini..."/>
    <ant dir="../jini" target="netbeans"/>
  </target>
  <target name="all-jndi" depends="all-openide,all-openidex,all-openide/deprecated,all-projects">
    <echo message="Building module jndi..."/>
    <ant dir="../jndi" target="netbeans"/>
  </target>
  <target name="all-logger" depends="all-openide,all-core">
    <echo message="Building module logger..."/>
    <ant dir="../logger" target="netbeans"/>
  </target>
  <target name="all-lexer" depends="all-openide">
    <echo message="Building module lexer..."/>
    <ant dir="../lexer" target="netbeans"/>
  </target>
  <target name="all-lexer/editorbridge" depends="all-openide,all-editor,all-lexer">
    <echo message="Building module lexer/editorbridge..."/>
    <ant dir="../lexer/editorbridge" target="netbeans"/>
  </target>
  <target name="all-lexer/editorbridge/calc" depends="all-openide,all-editor,all-lexer,all-lexer/editorbridge">
    <echo message="Building module lexer/editorbridge/calc..."/>
    <ant dir="../lexer/editorbridge/calc" target="netbeans"/>
  </target>
  <target name="all-makefile" depends="all-openide,all-openide/compiler,all-openide/execution,all-openide/deprecated">
    <echo message="Building module makefile..."/>
    <ant dir="../makefile" target="netbeans"/>
  </target>
  <target name="all-metrics" depends="all-openide,all-classfile,all-clazz,all-java">
    <echo message="Building module metrics..."/>
    <ant dir="../metrics" target="netbeans"/>
  </target>
  <target name="all-monitor" depends="all-openide,all-web/core,all-schema2beans,all-html,all-httpserver,all-openide/deprecated,all-tomcatint/bundledtomcat">
    <echo message="Building module monitor..."/>
    <ant dir="../monitor" target="netbeans"/>
  </target>
  <target name="all-mdr" depends="all-openide,all-openide/deprecated,all-openide/loaders,all-openidex,all-openidex/looks,all-core/naming">
    <echo message="Building module mdr..."/>
    <ant dir="../mdr" target="netbeans"/>
  </target>
  <target name="all-mdr/samples/xml" depends="all-openide,all-openidex,all-openidex/looks,all-xml/core,all-mdr">
    <echo message="Building module mdr/samples/xml..."/>
    <ant dir="../mdr/samples/xml" target="netbeans"/>
  </target>
  <target name="all-multicompile" depends="all-openide,all-openide/compiler,all-openide/execution">
    <echo message="Building module multicompile..."/>
    <ant dir="../multicompile" target="netbeans"/>
  </target>
  <target name="all-objectbrowser" depends="all-openide">
    <echo message="Building module objectbrowser..."/>
    <ant dir="../objectbrowser" target="netbeans"/>
  </target>
  <target name="all-openidex" depends="all-openide">
    <echo message="Building module openidex..."/>
    <ant dir="../openidex" target="netbeans"/>
  </target>
  <target name="all-projects" depends="all-openide,all-core,all-openide/deprecated,all-openide/compiler,all-openide/execution,all-debuggercore/oldapi">
    <echo message="Building module projects..."/>
    <ant dir="../projects" target="netbeans"/>
  </target>
  <target name="all-properties" depends="all-openide,all-editor,all-openide/deprecated">
    <echo message="Building module properties..."/>
    <ant dir="../properties" target="netbeans"/>
  </target>
  <target name="all-remotefs" depends="all-openide">
    <echo message="Building module remotefs..."/>
    <ant dir="../remotefs" target="netbeans"/>
  </target>
  <target name="all-rmi" depends="all-openide,all-java,all-debuggercore,all-openide/deprecated,all-java/srcmodel,all-openide/compiler,all-openide/execution,all-debuggercore/oldapi">
    <echo message="Building module rmi..."/>
    <ant dir="../rmi" target="netbeans"/>
  </target>
  <target name="all-schema2beans" depends="all-openide">
    <echo message="Building module schema2beans..."/>
    <ant dir="../schema2beans" target="netbeans"/>
  </target>
  <!-- XXX illegal dependence on core! -->
  <target name="all-scripting" depends="all-openide,all-openidex,all-core,all-openide/deprecated,all-openide/execution,all-openide/io">
    <echo message="Building module scripting..."/>
    <ant dir="../scripting" target="netbeans"/>
  </target>
  <target name="all-serialversion" depends="all-openide,all-openide/compiler,all-openide/io,all-java/srcmodel">
    <echo message="Building module serialversion..."/>
    <ant dir="../serialversion" target="netbeans"/>
  </target>
  <target name="all-sysprops" depends="all-openide">
    <echo message="Building module sysprops..."/>
    <ant dir="../sysprops" target="netbeans"/>
  </target>

  <!-- Tasklist modules -->
  <target name="all-tasklist/api" depends="all-openide">
    <echo message="Building module tasklist/api..."/>
    <ant dir="../tasklist/api" target="netbeans"/>
  </target>
  <target name="all-tasklist/core" depends="all-openide,all-tasklist/api">
    <echo message="Building module tasklist/core..."/>
    <ant dir="../tasklist/core" target="netbeans"/>
  </target>
  <target name="all-tasklist/usertasks" depends="all-openide,all-tasklist/api,all-tasklist/core">
    <echo message="Building module tasklist/usertasks..."/>
    <ant dir="../tasklist/usertasks" target="netbeans"/>
  </target>
  <target name="all-tasklist/suggestions" depends="all-openide,all-tasklist/api,all-tasklist/core">
    <echo message="Building module tasklist/suggestions..."/>
    <ant dir="../tasklist/suggestions" target="netbeans"/>
  </target>
  <target name="all-tasklist/docscan" depends="all-openide,all-tasklist/api,all-tasklist/core">
    <echo message="Building module tasklist/docscan..."/>
    <ant dir="../tasklist/docscan" target="netbeans"/>
  </target>
  <target name="all-tasklist/editor" depends="all-openide,all-editor,all-tasklist/api,all-tasklist/core,all-tasklist/usertasks">
    <echo message="Building module tasklist/editor..."/>
    <ant dir="../tasklist/editor" target="netbeans"/>
  </target>
  <target name="all-tasklist/bugs" depends="all-openide,all-tasklist/api,all-tasklist/core">
    <echo message="Building module tasklist/bugs..."/>
    <ant dir="../tasklist/bugs" target="netbeans"/>
  </target>
  <target name="all-tasklist/pmd" depends="all-openide,all-tasklist/api,all-tasklist/core">
    <echo message="Building module tasklist/pmd..."/>
    <ant dir="../tasklist/pmd" target="netbeans"/>
  </target>
  <target name="all-tasklist/javaparser" depends="all-openide,all-tasklist/api,all-tasklist/core,all-java">
    <echo message="Building module tasklist/javaparser..."/>
    <ant dir="../tasklist/javaparser" target="netbeans"/>
  </target>
  <target name="all-tasklist/javadoc" depends="all-openide,all-tasklist/api,all-tasklist/core,all-java,all-javadoc">
    <echo message="Building module tasklist/javadoc..."/>
    <ant dir="../tasklist/javadoc" target="netbeans"/>
  </target>
  <target name="all-tasklist/html" depends="all-openide,all-tasklist/api,all-tasklist/core,all-html,all-diff">
    <echo message="Building module tasklist/html..."/>
    <ant dir="../tasklist/html" target="netbeans"/>
  </target>
  <target name="all-tasklist/compiler" depends="all-openide,all-tasklist/api,all-tasklist/core,all-core/settings,all-openide/compiler,all-core/compiler">
    <echo message="Building module tasklist/compiler..."/>
    <ant dir="../tasklist/compiler" target="netbeans"/>
  </target>

  <target name="all-testtools" depends="all-openide,all-openide/compiler,all-openide/execution,all-openide/io,all-core,all-java,all-ant,all-jemmy,all-jemmysupport,all-jellytools">
    <echo message="Building module testtools..."/>
    <ant dir="../testtools" target="netbeans"/>
  </target>
  <target name="all-text" depends="all-openide">
    <echo message="Building module text..."/>
    <ant dir="../text" target="netbeans"/>
  </target>
  <target name="all-tomcatint/tomcat32" depends="all-openide,all-web">
    <echo message="Building module tomcatint/tomcat32..."/>
    <ant dir="../tomcatint/tomcat32" target="netbeans"/>
  </target>
  <target name="all-tomcatint/tomcat40" depends="all-openide,all-web/core,all-schema2beans,all-openide/deprecated,all-java/srcmodel,all-openide/execution,all-openide/compiler,all-openide/io,all-debuggercore/oldapi">
    <echo message="Building module tomcatint/tomcat40..."/>
    <ant dir="../tomcatint/tomcat40" target="netbeans"/>
  </target>
  <target name="all-tomcatint/bundledtomcat" depends="all-tomcatint/tomcat40">
    <echo message="Building module tomcatint/bundledtomcat..."/>
    <ant dir="../tomcatint/bundledtomcat" target="netbeans"/>
  </target>
  <target name="all-tomcatint/tomcat40autocompile" depends="all-tomcatint/tomcat40">
    <echo message="Building module tomcatint/tomcat40autocompile..."/>
    <ant dir="../tomcatint/tomcat40autocompile" target="netbeans"/>
  </target>
  <target name="all-translatedfiles" depends="init">
    <echo message="Building module translatedfiles..."/>
    <ant dir="../translatedfiles" target="netbeans"/>
  </target>
  <target name="all-usersguide" depends="all-openide">
    <echo message="Building module usersguide..."/>
    <ant dir="../usersguide" target="netbeans"/>
  </target>
  <target name="all-utilities" depends="all-openide,all-openide/deprecated,all-openide/io,all-openidex">
    <echo message="Building module utilities..."/>
    <ant dir="../utilities" target="netbeans"/>
  </target>
  <target name="all-utilities/group" depends="all-openide,all-openidex,all-core/settings,all-openide/deprecated,all-openide/compiler">
    <echo message="Building module utilities/group..."/>
    <ant dir="../utilities/group" target="netbeans"/>
  </target>
  <target name="all-vcscvs" depends="all-openide,all-openidex,all-editor,all-vcscore">
    <echo message="Building module vcscvs..."/>
    <ant dir="../vcscvs" target="netbeans"/>
  </target>
  <target name="all-vcscvs/compat" depends="all-openide,all-openidex,all-editor,all-vcscore,all-vcsgeneric">
    <echo message="Building module vcscvs compat..."/>
    <ant dir="../vcscvs/compat" target="netbeans"/>
  </target>
  <target name="all-vcsgeneric" depends="all-openide,all-openidex,all-vcscore,all-diff,all-openide/deprecated">
    <echo message="Building module vcsgeneric..."/>
    <ant dir="../vcsgeneric" target="netbeans"/>
  </target>

  <target name="all-vcsgeneric/profiles/cvsprofiles" depends="all-vcsgeneric,all-openide/deprecated">
    <echo message="Building module vcsgeneric/profiles/cvsprofiles"/>
    <ant dir="../vcsgeneric/profiles/cvsprofiles" target="netbeans"/>
  </target>

  <target name="all-vcsgeneric/profiles/clearcase" depends="all-vcsgeneric,all-openide/deprecated">
    <echo message="Building module vcsgeneric/profiles/clearcase"/>
    <ant dir="../vcsgeneric/profiles/clearcase" target="netbeans"/>
  </target>

  <target name="all-vcsgeneric/profiles/pvcs" depends="all-vcsgeneric,all-openide/deprecated">
    <echo message="Building module vcsgeneric/profiles/pvcs"/>
    <ant dir="../vcsgeneric/profiles/pvcs" target="netbeans"/>
  </target>

  <target name="all-vcsgeneric/profiles/vss" depends="all-vcsgeneric">
    <echo message="Building module vcsgeneric/profiles/vss"/>
    <ant dir="../vcsgeneric/profiles/vss" target="netbeans"/>
  </target>

  <!-- XXX check editor dependecy -->
  <target name="all-vcscore" depends="all-openide,all-openidex,all-editor,all-openide/deprecated,all-openide/io,all-openide/execution">
    <echo message="Building module vcscore..."/>
    <ant dir="../vcscore" target="netbeans"/>
  </target>
  <target name="all-javacvs" depends="all-openide,all-openidex,all-vcscore, all-diff,all-openide/deprecated">
    <echo message="Building module javacvs..."/>
    <ant dir="../javacvs" target="netbeans"/>
  </target>
  <target name="all-web" depends="all-web/servletapi23,all-web/core,all-web/jspparser,all-web/jspsyntax">
    <echo message="Building module web..."/>
  </target>
  <target name="all-web/servletapi23" depends="all-web/core">
    <echo message="Building module web/servletapi23..."/>
    <ant dir="../web/servletapi23" target="netbeans"/>
  </target>
  <!-- XXX illegal dependence on core! -->
  <target name="all-web/core" depends="all-openide,all-java,all-core,all-editor,all-j2eeserver/deprecated,all-html,all-httpserver,all-jarpackager,all-debuggercore,all-openidex,all-schema2beans,all-xml/api,all-openide/deprecated,all-java/srcmodel,all-openide/compiler,all-openide/execution,all-openide/io,all-debuggercore/oldapi">
    <echo message="Building module web/core..."/>
    <ant dir="../web/core" target="netbeans"/>
  </target>
  <target name="all-web/jspparser" depends="all-web/core,all-web/servletapi23,all-openide/deprecated,all-openide/compiler,all-openide/execution,all-openide/io">
    <echo message="Building module web/jspparser..."/>
    <ant dir="../web/jspparser" target="netbeans"/>
  </target>
  <target name="all-web/jspsyntax" depends="all-web/core,all-xml/text-edit">
    <echo message="Building module web/jspsyntax..."/>
    <ant dir="../web/jspsyntax" target="netbeans"/>
  </target>
  <target name="all-web/jspdebug" depends="all-web/core,all-openide/deprecated,all-java/srcmodel,all-openide/compiler,all-openide/execution,all-debuggercore/oldapi">
    <echo message="Building module web/jspdebug..."/>
    <ant dir="../web/jspdebug" target="netbeans"/>
  </target>
  <!-- XXX illegal dependence on core! -->
  <target name="all-web/taglibed" depends="all-web/core,all-jarpackager,all-core,all-xml/core,all-openide/deprecated,all-java/srcmodel,all-openide/io">
    <echo message="Building module web/taglibed..."/>
    <ant dir="../web/taglibed" target="netbeans"/>
  </target>
  <target name="all-web/advanced" depends="all-web/core,all-web/jspsyntax,all-jarpackager,all-debuggercore,all-xml/catalog,all-j2eeserver/deprecated,all-html,all-openidex,all-openide/deprecated,all-java/srcmodel,all-openide/execution">
    <echo message="Building module web/advanced..."/>
    <ant dir="../web/advanced" target="netbeans"/>
  </target>
  <target name="all-webl" depends="all-openide,all-java,all-openide/compiler,all-openide/execution,all-openide/deprecated">
    <echo message="Building module webl..."/>
    <ant dir="../webl" target="netbeans"/>
  </target>
  <target name="all-cpplite" depends="all-openide,all-editor,all-java,all-openide/deprecated,all-openide/compiler,all-openide/execution">
    <echo message="Building module cpplite..."/>
    <ant dir="../cpplite" target="netbeans"/>
  </target>

  <!-- XXX illegal dependence on core! -->
  <target name="all-cpp" depends="all-openide,all-editor,all-core,all-openide/deprecated,all-openide/compiler,all-openide/execution,all-openide/io">
    <echo message="Building module cpp..."/>
    <ant dir="../cpp" target="netbeans"/>
  </target>

  <!-- XXX illegal dependence on core! -->
  <target name="all-externaleditor" depends="all-openide,all-editor,all-core">
    <echo message="Building module externaleditor..."/>
    <ant dir="../externaleditor" target="netbeans"/>
  </target>

  <target name="all-corba" depends="all-openide,all-editor,all-java,all-openide/compiler,all-openide/execution,all-projects">
    <echo message="Building module corba..."/>
    <ant dir="../corba" target="netbeans"/>
  </target>

  <!-- XXX illegal dependence on core! -->
  <target name="all-ui/welcome" depends="all-openide,all-core,all-utilities,all-openide/deprecated">
    <echo message="Building module ui/welcome..."/>
    <ant dir="../ui/welcome" target="netbeans"/>
  </target>

  <!-- Libs modules -->
  <target name="all-libs/xalan" depends="init">
      <echo message="Building module libs/xalan..."/>
      <ant dir="../libs/xalan" target="netbeans"/>
  </target>

  <target name="all-libs/jaxp" depends="init">
      <echo message="Building module libs/jaxp..."/>
      <ant dir="../libs/jaxp" target="netbeans"/>
  </target>

  <target name="all-libs/xerces" depends="init">
      <echo message="Building module libs/xerces..."/>
      <ant dir="../libs/xerces" target="netbeans"/>
  </target>
  
  <target name="all-libs/regexp" depends="init">
      <echo message="Building module libs/regexp..."/>
      <ant dir="../libs/regexp" target="netbeans"/>
  </target>
  
  <target name="all-libs/j2eeeditor" depends="init">
      <echo message="Building module libs/j2eeeditor..."/>
      <ant dir="../libs/j2eeeditor" target="netbeans"/>
  </target>

  <target name="all-libs" depends="all-libs/xalan, all-libs/jaxp, all-libs/xerces, all-libs/j2eeeditor"/>


  <!-- XML modules -->
  <target name="all-xml/api" depends="all-openide, all-libs/jaxp">
      <echo message="Building module xml/api..."/>
      <ant dir="../xml/api" target="netbeans"/>
  </target>

  <target name="all-xml/core" depends="all-openide, all-xml/api, all-openide/deprecated,all-openide/execution,all-openide/io">
      <echo message="Building module xml/core..."/>
      <ant dir="../xml/core" target="netbeans"/>
  </target>

  <target name="all-xml/tax" depends="all-openide, all-xml/api, all-xml/core, all-openide/deprecated">
      <echo message="Building module xml/tax..."/>
      <ant dir="../xml/tax" target="netbeans"/>
  </target>

 <target name="all-xml/catalog" depends="all-openide, all-xml/api, all-xml/core,all-openide/deprecated">
      <echo message="Building module xml/catalog..."/>
      <ant dir="../xml/catalog" target="netbeans"/>
  </target>

  <target name="all-xml/tools" depends="all-openide, all-libs/jaxp, all-xml/api, all-xml/tax, all-xml/core,all-openide/deprecated,all-java/srcmodel">
      <echo message="Building module xml/tools..."/>
      <ant dir="../xml/tools" target="netbeans"/>
  </target>

  <target name="all-xml/text-edit" depends="all-openide, all-editor, all-xml/tax, all-xml/core">
      <echo message="Building module xml/text-edit..."/>
      <ant dir="../xml/text-edit" target="netbeans"/>
  </target>

  <target name="all-xml/tree-edit" depends="all-openide, all-xml/api, all-xml/tax, all-xml/core,all-openide/deprecated">
      <echo message="Building module xml/tree-edit..."/>
      <ant dir="../xml/tree-edit" target="netbeans"/>
  </target>

  <target name="all-xml/css" depends="all-openide, all-editor, all-xml/api,all-openide/deprecated,all-openide/io">
      <echo message="Building module xml/css..."/>
      <ant dir="../xml/css" target="netbeans"/>
  </target>

  <target name="all-xml/xsl" depends="all-openide, all-httpserver/servletapi, all-libs/jaxp, all-xml/api, all-xml/tax, all-xml/core,all-openide/deprecated,all-openide/execution">
      <echo message="Building module xml/xsl..."/>
      <ant dir="../xml/xsl" target="netbeans"/>
  </target>

  <target name="all-xml/schema" depends="all-openide, all-libs/jaxp, all-xml/api, all-xml/tax, all-xml/core">
      <echo message="Building xml/schema module..."/>
      <ant dir="../xml/schema" target="netbeans"/>
  </target>

  <target name="all-xml" depends="all-xml/api, all-xml/tax, all-xml/core, all-xml/catalog, all-xml/tools, all-xml/text-edit, all-xml/tree-edit, all-xml/css, all-xml/xsl, all-xml/schema"/>

  <target name="all-treefs" depends="all-openide">
    <echo message="Building module treefs..."/>
    <ant dir="../treefs" target="netbeans"/>
  </target>

  <target name="all-openidex/looks" depends="all-openide,all-core/naming">
      <echo message="Building module openidex/looks..."/>
      <ant dir="../openidex/looks" target="netbeans"/>
  </target>

  <target name="all-utilities/loaderswitcher" depends="all-openide">
      <echo message="Building module utilities/loaderswitcher..."/>
      <ant dir="../utilities/loaderswitcher" target="netbeans"/>
  </target>

  <target name="all-xtest" depends="all-openide,all-openide/io,all-openide/execution,all-core,all-core/execution,all-core/term,all-core/output">
      <echo message="Building module xtest..."/>
      <ant dir="../xtest" antfile="build.xml" target="netbeans"/>
  </target>

  <target name="all-contrib/archiver" depends="all-openide,all-openide/loaders,all-openide/io,all-java/api">
    <echo message="Building module contrib/archiver..."/>
    <ant dir="../contrib/archiver" target="netbeans"/>
  </target>

  <target name="all-jasm" depends="all-openide,all-openide/loaders,all-editor,all-java/srcmodel,all-openide/deprecated,all-openide/execution,all-openide/compiler,all-clazz">
      <echo message="Building module jasm..."/>
      <ant dir="../jasm" target="netbeans"/>
  </target>

  <!-- #27098: MakeParserDB requires several modules to have been successfully built. -->
  <!-- Target all/mmm should depend on makeparserdb-modules if mmm/build.xml uses <makeparserdb>. -->
  <target name="makeparserdb-modules" depends="all-openide,all-openide/loaders,all-openide/execution,all-openide/io,all-core,all-classfile,all-java/api,all-java/srcmodel,all-java,all-editor,all-debuggercore/oldapi,all-openide/compiler,all-libs/regexp,all-core/execution,all-core/compiler,all-core/output,all-core/term"/>
  
  <!-- build NBMs for selected modules -->
  <target name="build-nbms" depends="init">
      <!-- It's good idea to call merge target before this one.
           NbMerge.java can set property "modules" to the list of realy
           built modules (excluding fixedmodules which must build everytime). -->
      <for-each startdir=".." target="nbm" locations="${allmodules}"/>
  </target>
  <target name="nbm"/><!-- dummy target -->

  <!-- build javadoc for selected modules -->
  <target name="build-javadoc" depends="init" description="Builds Javadoc documentation for modules; pass -Dmoduleconfig=javadoc and on branches e.g. -Djavadoc.web.root=http://www.netbeans.org/download/release35/javadoc">
      <ant dir="." target="merge">
          <property name="modules" value="${modules}"/>
          <property name="fixedmodules" value="${fixedmodules}"/>
          <property name="merge.dependent.modules" value="true"/>
          <property name="stop.when.broken.module" value="false"/>
      </ant>
      
      <mkdir dir="modules_exported_interfaces" />
      <property name="export.interfaces" location="modules_exported_interfaces" />
      
      <!-- build javadoc for supported APIs -->
      <for-each startdir=".." target="javadoc" locations="${fixedmodules}"/>
      <!-- build javadoc for unsupported APIs -->
      <for-each startdir=".." target="javadoc" locations="${modules}"/>
      <taskdef name="simplemerge" classname="org.netbeans.nbbuild.SimpleMerge" classpath="nbantext.jar"/>
      <simplemerge topdir=".." subdir="javadoc" dest="modules_javadoc" modules="${fixedmodules}"/>
      <simplemerge topdir=".." subdir="javadoc" dest="modules_javadoc" modules="${modules}"/>
      
      <echo file="modules_exported_interfaces/header.gen" >&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;apis&gt;
</echo>
      
      <echo file="modules_exported_interfaces/footer.gen" >
        &lt;/apis&gt;
      </echo>
      
      <concat destfile="modules_exported_interfaces/doc.gen" >
          <fileset dir="modules_exported_interfaces" includes="header.gen" />
          <fileset dir="modules_exported_interfaces" includes="*" excludes="*.gen" />
          <fileset dir="modules_exported_interfaces" includes="footer.gen" />
      </concat>
      
      <style 
        in="modules_exported_interfaces/doc.gen" 
        out="modules_javadoc/index.html" 
        style="javadoctools/export2html.xsl"
      />
      
      <delete dir="modules_exported_interfaces" />
  </target>

  <target name="build-messaging" depends="init">
    <echo message="Starting a build for NetBeans (build ${buildnum}, config '${moduleconfig}') ..."/>
    <echo message="Selected modules: ${modules}"/>
    <echo message="OS: ${os.name} ${os.version}  Locale: ${user.language}_${user.region}"/>
    <echo message="Java: ${java.vendor} ${java.version} in ${java.home}; for NetBeans: ${jdkhome}"/>
    <echo message="Classpath: ${java.class.path}"/>
  </target>

  <!-- Use of nbmerge target has the effect of automatically depending on all-X for every module. -->
  <!-- It also runs deltree(dir=wherever) and copydir(src=../X/netbeans,dest=wherever) to create the IDE install. -->

  <target name="build-nozip" depends="delete-and-merge" description="Build the IDE but do not create a final ZIP file.">
    <taskdef name="createmodulexml" classname="org.netbeans.nbbuild.CreateModuleXML" classpath="nbantext.jar"/>
    <mkdir dir="${netbeans.dest}/system/Modules"/>
    <mkdir dir="${netbeans.dest}/modules/autoload"/>
    <mkdir dir="${netbeans.dest}/modules/eager"/>
    <createmodulexml xmldir="${netbeans.dest}/system/Modules">
      <enabled dir="${netbeans.dest}/modules">
        <include name="*.jar"/>
        <!-- Just to test that we can in fact preconfigure some disabled modules: -->
        <exclude name="icebrowser.jar"/>
      </enabled>
      <disabled dir="${netbeans.dest}/modules">
        <include name="icebrowser.jar"/>
      </disabled>
      <autoload dir="${netbeans.dest}/modules/autoload">
        <include name="*.jar"/>
      </autoload>
      <eager dir="${netbeans.dest}/modules/eager">
        <include name="*.jar"/>
      </eager>
    </createmodulexml>
    <echo file="${netbeans.dest}/build_info">NetBeans dev build
------------------
Number:   ${buildnumber}
Date:     ${TODAY}
Branding:
Branch:   trunk
Tag:
</echo>
  </target>

  <target name="build" depends="build-nozip"
          description="Create a complete build including a ZIP distribution (but do not try it).">
    <!-- zip task not well suited to making final build, as it does not set +x bits -->
    <!-- so on Unix try to use native ZIP first -->
    <delete file="NetBeans-${buildnum}.zip"/>
    <!-- XXX Ant 1.5.2 can store +x bit, see zipfileset -->
    <exec executable="zip" dir="." os="Linux SunOS Solaris Mac OS X" failonerror="false">
      <arg value="-r"/>
      <arg value="NetBeans-${buildnum}.zip"/>
      <arg value="${netbeans.dest}"/>
    </exec>
    <zip zipfile="NetBeans-${buildnum}.zip" basedir=".">
      <include name="${netbeans.dest}/"/>
    </zip>
    <echo>Build created; see NetBeans-${buildnum}.zip (in nbbuild/).
If you like, you may run the IDE straight from
the ${netbeans.dest}/bin/ directory.
(For example, type: ant tryme)
</echo>
  </target>

  <target name="checkXMLs" depends="bootstrap">
    <ant dir="../core/external" target="unscramble"/>
    <ant dir="../xml/external" target="unscramble"/>
    <taskdef name="validatexml" classname="org.netbeans.nbbuild.XMLValidate">
      <classpath>
        <pathelement location="nbantext.jar"/>
        <fileset dir="../xml/external">
          <include name="resolver*.jar"/>
        </fileset>
      </classpath>
    </taskdef>
    <validatexml basedir="../" catalog="../www/www/dtds/catalog">
        <include name="*/build.xml"/>
	<include name="*/src/**/*.xml/"/>
    </validatexml>
  </target>
  
  <target name="delete-and-merge" depends="merge-delete,merge" />   

  <target name="merge-delete" depends="init">
    <delete dir="${netbeans.dest}" />
  </target>
  
  <target name="merge" depends="build-messaging">
    <mkdir dir="${netbeans.dest}"/>
    <nbmerge failonerror="${stop.when.broken.modules}" 
             dest="${netbeans.dest}" 
             topdir=".." 
             fixedmodules="${fixedmodules}" 
             modules="${modules}"
             builtmodulesproperty="${built.modules.property}" 
             targetprefix="all-" 
             mergedependentmodules="${merge.dependent.modules}" >
      <suppress locale="ja" unless="netbeans.japanese"/>
    </nbmerge>
    <chmod perm="ugo+x">
      <fileset dir="${netbeans.dest}">
        <include name="bin/**/*.sh"/>
        <include name="bin/**/*.pl"/>
        <include name="bin/fastjavac/fastjavac.linux"/>
        <include name="bin/fastjavac/fastjavac.sun"/>
        <include name="bin/fastjavac/fastjavac.sun.intel"/>
      </fileset>
    </chmod>
  </target>

  <target name="sanity-check" depends="testuserdir-delete,sanity-start" description="Test whether the build can start up without problems."/>
  <target name="testuserdir-delete" depends="init">
    <delete dir="${test.user.dir}"/>
  </target>
  <target name="sanity-start" depends="init,maybe-build-nozip">
    <mkdir dir="${test.user.dir}"/>
    <echo>Starting the IDE as a sanity check...</echo>
    <echo>WARNING - the sanity-start target is deprecated. Use commit-validation instead.</echo>
    <!-- XXX better would be to scan start log for stacktraces and just show those; -->
    <!-- possibly after filtering for duplicates or something like this. -->
    <!-- Timeout is ten minutes; should be enough for valid start, while preventing -->
    <!-- a deadlock from hanging an automated build: -->
    <exec os="Windows NT Windows 95 Windows 98 Windows 2000 Windows XP" executable="${netbeans.dest.abs}/bin/runide.exe" failonerror="yes" timeout="600000">
      <arg value="-jdkhome"/>
      <arg file="${jdkhome}"/>
      <arg value="-userdir"/>
      <arg file="${test.user.dir}"/>
      <arg line="${sanitystart.args}"/>
    </exec>
    <exec os="Linux SunOS Solaris Mac OS X" dir="." executable="sh" failonerror="yes" timeout="600000">
      <arg value="${netbeans.dest}/bin/runide.sh"/>
      <arg value="-jdkhome"/>
      <arg file="${jdkhome}"/>
      <arg value="-userdir"/>
      <arg file="${test.user.dir}"/>
      <arg line="${sanitystart.args}"/>
    </exec>
    <echo>Finished starting the IDE, pay attention to any reported errors.</echo>
  </target>

  <target name="check-for-build">
    <available property="have-build" file="${netbeans.dest}/lib/openide.jar"/>
  </target>
  <target name="maybe-build-nozip" depends="check-for-build" unless="have-build">
    <ant dir="." target="build-nozip"/>
  </target>

  <target name="nozip-check" 
          depends="build-nozip,sanity-check">
    <echo>WARNING - the nozip-check target is deprecated. Use all-nozip instead.</echo>
  </target>

  <target name="tryme" depends="tryme-debug,tryme-run"
          description="Try running the IDE interactively (build it first if needed).
It is possible to use -Ddebug.port=3234 -Ddebug.pause=y to start the system in debug mode" 
   />
          
          
  <target name="tryme-run" depends="init,maybe-build-nozip" unless="debug.port" >
    <exec os="Windows NT Windows 95 Windows 98 Windows 2000 Windows XP" executable="${netbeans.dest.abs}/bin/runide.exe" failonerror="yes">
      <arg value="-jdkhome"/>
      <arg file="${jdkhome}"/>
      <arg value="-userdir"/>
      <arg file="${test.user.dir}"/>
      <arg line="${tryme.args}"/>
    </exec>
    <exec os="Linux SunOS Solaris Mac OS X" dir="." executable="sh" failonerror="yes">
      <arg value="${netbeans.dest}/bin/runide.sh"/>
      <arg value="-jdkhome"/>
      <arg file="${jdkhome}"/>
      <arg value="-userdir"/>
      <arg file="${test.user.dir}"/>
      <arg line="${tryme.args}"/>
    </exec>
  </target>
  
  <target name="tryme-debug" depends="init,maybe-build-nozip" if="debug.port" >
    <property name="debug.pause" value="n" />
  
    <exec os="Windows NT Windows 95 Windows 98 Windows 2000 Windows XP" executable="${netbeans.dest.abs}/bin/runide.exe" failonerror="yes">
      <arg value="-jdkhome"/>
      <arg file="${jdkhome}"/>
      <arg value="-userdir"/>
      <arg file="${test.user.dir}"/>
      <arg line="${tryme.args}"/>
      <arg line="-J-Xdebug -J-Xnoagent -J-Xrunjdwp:transport=dt_socket,suspend=${debug.pause},server=y,address=${debug.port}" />
    </exec>
    <exec os="Linux SunOS Solaris Mac OS X" dir="." executable="sh" failonerror="yes">
      <arg value="${netbeans.dest}/bin/runide.sh"/>
      <arg value="-jdkhome"/>
      <arg file="${jdkhome}"/>
      <arg value="-userdir"/>
      <arg file="${test.user.dir}"/>
      <arg line="${tryme.args}"/>
      <arg line="-J-Xdebug -J-Xnoagent -J-Xrunjdwp:transport=dt_socket,suspend=${debug.pause},server=y,address=${debug.port}" />
    </exec>
  </target>

  <target name="l10n-kit" depends="init">
    <taskdef name="l10n" classname="org.netbeans.nbbuild.L10nTask"
             classpath="nbantext.jar"/>
    <delete dir="${l10n.dist.dir}"/>
    <mkdir dir="${l10n.dist.dir}"/>
    <delete dir="tmp"/>
    <mkdir dir="tmp"/>
    <property name="nbroot" location=".."/>
    <l10n topdirs="${nbroot}" modules="${fixedmodule},${modules}"
          localizablefile="l10n.list" generatedfile="l10n.list.translated"
          distdir="${l10n.dist.dir}" changedfile="l10n.list.changed"
          builddir="tmp" buildnumber="${buildnumber}"
          excludepattern="**/ja/,**/*_ja.*"/>
    <delete dir="tmp"/>
  </target>

  <target name="bootstrap-javadoc"
          depends="bootstrap"
          description="Generate Javadoc for Ant extensions.">
    <mkdir dir="www/nbantext-javadoc"/>
    <tstamp/>
    <javadoc sourcepath="antsrc"
             destdir="www/nbantext-javadoc"
             packagenames="org.netbeans.nbbuild.*"
             windowtitle="NetBeans Ant Extensions"
             doctitle="Extended Ant Tasks for Building NetBeans"
             nodeprecatedlist="true"
             notree="true"
             noindex="true"
             nohelp="true"
             nonavbar="true"
             author="false"
             version="false"
             bottom="Built on ${TODAY}"
    >
      <classpath refid="bootstrap-cp"/>
      <link href="http://nagoya.apache.org/gump/javadoc/ant/build/javadocs" offline="true" packagelistloc="antsrc"/>
    </javadoc>
  </target>

  <target name="clean-external" if="${extmodule}/external.exists">
    <echo message="Cleaning external - ${extmodule}"/>
    <ant dir="../${extmodule}/external" target="clean"/>
  </target>

  <target name="doclean-external">
    <available file="../${extmodule}/external/build.xml" property="${extmodule}/external.exists"/>
    <antcall target="clean-external"/>
  </target>

  <target name="real-clean" depends="clean"
          description="Clean everything possible.">
    <echo message="Cleaning old builds..."/>
    <delete>
      <fileset dir=".">
        <include name="NetBeans-*.log"/>
        <include name="NetBeans-*.zip"/>
      </fileset>
    </delete>
    <antcall target="doclean-external">
      <param name="extmodule" value="ant"/>
    </antcall>
    <antcall target="doclean-external">
      <param name="extmodule" value="corba"/>
    </antcall>
    <antcall target="doclean-external">
      <param name="extmodule" value="core"/>
    </antcall>
    <antcall target="doclean-external">
      <param name="extmodule" value="httpserver"/>
    </antcall>
    <antcall target="doclean-external">
      <param name="extmodule" value="j2eeserver"/>
    </antcall>
    <antcall target="doclean-external">
      <param name="extmodule" value="java"/>
    </antcall>
    <antcall target="doclean-external">
      <param name="extmodule" value="nbbuild"/>
    </antcall>
    <antcall target="doclean-external">
      <param name="extmodule" value="scripting"/>
    </antcall>
    <antcall target="doclean-external">
      <param name="extmodule" value="tomcatint"/>
    </antcall>
    <antcall target="doclean-external">
      <param name="extmodule" value="xml"/>
    </antcall>
    <antcall target="doclean-external">
      <param name="extmodule" value="web"/>
    </antcall>
    <antcall target="doclean-external">
      <param name="extmodule" value="libs"/>
    </antcall>
    <antcall target="doclean-external">
      <param name="extmodule" value="junit"/>
    </antcall>
    <antcall target="doclean-external">
      <param name="extmodule" value="lexer"/>
    </antcall>
    <antcall target="doclean-external">
      <param name="extmodule" value="mdr"/>
    </antcall>
    <antcall target="doclean-external">
      <param name="extmodule" value="objectbrowser"/>
    </antcall>
    <antcall target="doclean-external">
      <param name="extmodule" value="tasklist"/>
    </antcall>
    <antcall target="doclean-external">
      <param name="extmodule" value="xtest"/>
    </antcall>
    <antcall target="doclean-external">
      <param name="extmodule" value="qa"/>
    </antcall>
    <!-- This step must be last: -->
    <echo message="Cleaning NetBeans-specific Ant extensions..."/>
    <delete file="nbantext.jar" quiet="true"/>
    <delete>
      <fileset dir="antsrc">
        <include name="**/*.class"/>
      </fileset>
    </delete>
  </target>
  
  <target name="ant-clean">
    <delete file="nbantext.jar"/>
  </target>

  <target name="localclean" depends="init">
    <delete dir="${netbeans.dest}"/>
    <delete dir="${test.user.dir}"/>
    <delete dir="modules_javadoc"/>
    <delete file="moduledefs-tmp.properties"/>
  </target>

  <target name="clean" depends="init,localclean"
          description="Clean out (almost) all build products.">
    <cleanall topdir=".." 
              modules="${allmodules}" 
              targetname="clean"
              resolvedependencies="${resolve.clean.dependencies}"
              deptargetprefix="all-"
              failonerror="${stop.when.clean.error}" />
    <echo message="Run `ant real-clean' if desired."/>
  </target>

  <target name="print-selected-modules" depends="init" description="Prints list of modules to build in selected moduleconfig.">
    <echo message="modules=${allmodules}"/>
  </target>

  <target name="print-cvs-modules" depends="init" description="Prints list of cvs modules required to build in selected moduleconfig.">
    <taskdef name="printcvsmodules" classname="org.netbeans.nbbuild.PrintCvsModules" classpath="nbantext.jar"/>
    <printcvsmodules modules="${fixedmodules},${modules}" targetprefix="all-" />
  </target>

  <target name="check-commit-validation">
    <condition property="run.validation" >
        <and>
          <available file="../ide/test/build.xml" />
          <available file="../jemmy/build.xml" />
          <available file="../jellytools/build.xml" />
          <available file="../xtest/build.xml" />
          <not>
            <isfalse value="${nb.run.validation}" />
          </not>
        </and>
    </condition>
  </target>
  
  <target name="commit-validation" depends="commitValidation,no-commit-validation" description="Runs tests to validate IDE before commit."/>

  <!-- keep this target name at least for a while for backward compat -jglick -->
  <target name="commitValidation" depends="check-commit-validation" if="run.validation">
    <property name="xtest.home" location="../xtest"/>
    <ant dir="${xtest.home}/instance" target="runtests">
        <property name="xtest.config" value="commit-validation-nb"/>
        <property name="xtest.fail.on.failure" value="true"/>
    </ant>
  </target>

  <target name="no-commit-validation" depends="check-commit-validation" unless="run.validation">
    <echo>
        *** WARNING ***
        You do not seem to have the modules needed to run the commit validation test suite. 
        You may not commit any changes into the CVS repository without running these tests.
        For more information: http://www.netbeans.org/community/guidelines/commit.html
    </echo>
  </target>
  
</project>
