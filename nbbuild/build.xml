<?xml version='1.0' encoding='ISO-8859-1' ?>
<!--
                Sun Public License Notice

The contents of this file are subject to the Sun Public License
Version 1.0 (the "License"). You may not use this file except in
compliance with the License. A copy of the License is available at
http://www.sun.com/

The Original Code is NetBeans. The Initial Developer of the Original
Code is Sun Microsystems, Inc. Portions Copyright 1997-2000 Sun
Microsystems, Inc. All Rights Reserved.
-->

<!--
ToDo:
- build validator DTD for this build system
- sanity check that module list actually satisfies module dependencies
Modules:
treefs (complete yet?)
workspaceswitcher
-->

<project name="nbbuild" default="all" basedir=".">
  <property name="build.sysclasspath" value="ignore"/>

  <!-- To make people happy who want to do `ant clean all': -->
  <target name="all" depends="build,sanity-check" description="Build the IDE and run a sanity check."/>

  <target name="bootstrap-init">
    <property name="binroot" location="../../nbextra"/>
    <available property="have-binaries-already" file="${binroot}/core/release/lib/ext/jh.jar"/>
  </target>

  <target name="bootstrap" depends="check-for-binaries"
          description="Bootstrap NetBeans-specific Ant extensions.">
    <echo message="Bootstrapping NetBeans-specific Ant extensions..."/>
    <javac srcdir="antsrc" destdir="antsrc" deprecation="true" debug="${build.compiler.debug}">
      <classpath>
        <!-- Needed for CheckLinks: -->
        <pathelement location="${binroot}/core/release/lib/ext/regexp.jar"/>
        <!-- For running inside IDE, to pick up ant.jar -->
        <pathelement location="${binroot}/nbbuild/lib/ant.jar"/>
        <pathelement location="${binroot}/core/release/lib/ext/xerces.jar"/>
        <pathelement location="${binroot}/nbbuild/lib/jhall.jar"/>
      </classpath>
    </javac>
    <jar jarfile="nbantext.jar" basedir="antsrc">
      <exclude name="**/*.java"/>
    </jar>
  </target>

  <target name="setup-jdkhome-1">
    <!-- Note: user-configured -Djavahome=... will always override this: -->
    <property name="javahome" location="${java.home}"/>
    <available property="javahome-valid" file="${javahome}/lib/tools.jar"/>
  </target>
  <target name="setup-jdkhome-2" depends="setup-jdkhome-1" if="javahome-valid">
    <property name="jdkhome" value="${javahome}"/>
    <property name="jdkhome-valid" value="true"/>
  </target>
  <target name="setup-jdkhome-3" depends="setup-jdkhome-1" unless="javahome-valid">
    <property name="jdkhome" location="${javahome}/.."/>
    <available property="jdkhome-valid" file="${jdkhome}/lib/tools.jar"/>
  </target>
  <target name="setup-jdkhome-4" depends="setup-jdkhome-2,setup-jdkhome-3" unless="jdkhome-valid">
    <fail message="No tools.jar found in ${javahome}! Set -Djavahome=... as needed."/>
  </target>

  <target name="init" depends="bootstrap,setup-jdkhome-4">
    <tstamp>
    	<format property="buildnumber" pattern="yyyyMMddHHmm"/>
    </tstamp>
    <taskdef name="cleanall" classname="org.netbeans.nbbuild.CleanAll" classpath="nbantext.jar"/>
    <taskdef name="nbmerge" classname="org.netbeans.nbbuild.NbMerge" classpath="nbantext.jar"/>
    <taskdef name="configmods" classname="org.netbeans.nbbuild.ConfigureModules" classpath="nbantext.jar"/>
    <taskdef name="makeupdatedesc" classname="org.netbeans.nbbuild.MakeUpdateDesc" classpath="nbantext.jar"/>
    <!-- Overridable. Note: need not necessarily be a number at all): -->
    <property name="buildnum" value="dev-${buildnumber}"/>
    <property name="netbeans.dest" value="netbeans"/>
    <property name="test.user.dir" location="testuserdir"/>
    <!-- For example, "-nogui -nosplash" is useful on headless machines: -->
    <property name="sanitystart.args.additional" value=""/>
    <property name="tryme.args.additional" value=""/>
    <!-- Best to leave this alone, though, unless you know what you are doing: -->
    <property name="sanitystart.args" value=" -J-Dnetbeans.close=true -J-Dnetbeans.debug.exceptions=true ${sanitystart.args.additional}"/>
    <!-- But this it is OK to change: -->
    <property name="tryme.args" value=" -J-Dnetbeans.debug.exceptions=true ${tryme.args.additional}"/>
    <!-- Only useful to override in conjunction with merge target during development: -->
    <property name="fixedmodules" value="core,openide,core/javahelp"/>
    <!-- Override this with the Ant command, e.g. -Dmoduleconfig=superslim -->
    <property name="moduleconfig" value="stable"/>
    <!-- You can also explicitly set a particular list of modules if you prefer: -->
    <!-- -Dmodules=foo,bar,... (do not include core or openide) -->
    <configmods property="modules" selectedconfig="${moduleconfig}">
      <config name="superslim" modules="classfile,clazz,editor,html,image,java,openidex,projects,text,utilities"/>
      <config name="slim" modules="autoupdate,beans,classfile,clazz,debuggercore,debuggerjpda,debuggertools,editor,form,html,httpserver,image,java,openidex,projects,text,utilities"/>
      <!-- [PENDING] A poor name; 'standard' would be more in line with the CVS pseudomodule. -->
      <config name="stable" modules="ant,apisupport/lite,applet,autoupdate,beans,classfile,clazz,debuggercore,debuggerjpda,debuggertools,editor,extbrowser,form,html,httpserver,httpserver/servletapi,i18n,image,j2eeserver,jarpackager,java,javacvs,javadoc,jndi,openidex,projects,properties,rmi,scripting,text,tomcatint/tomcat32,usersguide,utilities,vcscore,vcscvs/compat,vcsgeneric,web/servletapi23,web/core,web/jspparser,web/jspsyntax,xml/tax,xml/core,xml/catalog,xml/tools,xml/text-edit,xml/tree-edit,xml/css"/>
      <config name="stable-with-apisupport" modules="ant,apisupport,apisupport/lite,applet,autoupdate,beans,classfile,clazz,debuggercore,debuggerjpda,debuggertools,editor,extbrowser,form,html,httpserver,httpserver/servletapi,i18n,image,j2eeserver,jarpackager,java,javacvs,javadoc,jndi,openidex,projects,properties,rmi,scripting,text,tomcatint/tomcat32,usersguide,utilities,vcscore,vcscvs/compat,vcsgeneric,web/servletapi23,web/core,web/jspparser,web/jspsyntax,xml/tax,xml/core,xml/catalog,xml/tools,xml/text-edit,xml/tree-edit,xml/css"/>
      <config name="bloated" modules="ant,apisupport,apisupport/lite,applet,autoupdate,beans,classfile,classclosure,clazz,cpp,cpplite,debuggercore,debuggerjpda,debuggertools,editor,extbrowser,externaleditor,form,freestylebrowser,html,httpserver,httpserver/servletapi,i18n,icebrowser,image,innertesters,j2eeserver,jarpackager,java,javacvs,javadoc,logger,makefile,multicompile,objectbrowser,openidex,projects,properties,remotefs,rmi,schema2beans,scripting,serialversion,sysprops,text,tomcatint/tomcat32,usersguide,utilities,vcscore,vcscvs,vcscvs/compat,vcsgeneric,web/servletapi23,web/core,web/jspparser,web/jspsyntax,web/jspdebug,web/advanced,xml/tax,xml/core,xml/catalog,xml/tools,xml/text-edit,xml/tree-edit,xml/css"/>
      <!-- You are on your own for getting the binaries for some of these: -->
      <config name="bloated-plus-extrabins" modules="ant,apisupport,apisupport/lite,applet,autoupdate,beans,classfile,classclosure,clazz,cpp,cpplite,debuggercore,debuggerjpda,debuggertools,editor,extbrowser,externaleditor,form,freestylebrowser,html,httpserver,httpserver/servletapi,i18n,icebrowser,image,innertesters,j2eeserver,jarpackager,java,javacvs,javadoc,jini,logger,makefile,multicompile,objectbrowser,openidex,projects,properties,remotefs,rmi,schema2beans,scripting,serialversion,sysprops,text,tomcatint/tomcat32,usersguide,utilities,vcscore,vcscvs,vcscvs/compat,vcsgeneric,web/servletapi23,web/core,web/jspparser,web/jspsyntax,web/jspdebug,web/advanced,xml/tax,xml/core,xml/catalog,xml/tools,xml/text-edit,xml/tree-edit,xml/css"/>
    </configmods>
  </target>

  <target name="check-for-binaries" depends="bootstrap-init" unless="have-binaries-already">
    <fail message="You seem to be missing the required download of binaries which are required to build the IDE. Please see: http://www.netbeans.org/downloads.html"/>
  </target>

  <!-- How to build the IDE core: -->
  <target name="all-openide" depends="init">
    <echo message="Building Open APIs..."/>
    <ant dir="../openide" target="netbeans"/>
  </target>
  <target name="all-core" depends="all-openide">
    <echo message="Building IDE core implementation..."/>
    <ant dir="../core" target="netbeans"/>
  </target>
  <target name="all-core/javahelp" depends="all-openide">
    <echo message="Building module core/javahelp..."/>
    <ant dir="../core/javahelp" target="netbeans"/>
  </target>

  <!-- And the modules: -->
  <target name="all-ant" depends="all-openide">
    <echo message="Building module ant..."/>
    <ant dir="../ant" target="netbeans"/>
  </target>
  <target name="all-apisupport" depends="all-openide,all-core,all-core/javahelp,all-jarpackager,all-ant,all-apisupport/lite">
    <echo message="Building module apisupport..."/>
    <ant dir="../apisupport" target="netbeans"/>
  </target>
  <target name="all-apisupport/lite" depends="all-openide,all-core,all-jarpackager">
    <echo message="Building module apisupport lite..."/>
    <ant dir="../apisupport/lite" target="netbeans"/>
  </target>
  <target name="all-applet" depends="all-openide,all-debuggercore">
    <echo message="Building module applet..."/>
    <ant dir="../applet" target="netbeans"/>
  </target>
  <target name="all-autoupdate" depends="all-openide,all-core">
    <echo message="Building module autoupdate..."/>
    <ant dir="../autoupdate" target="netbeans"/>
  </target>
  <target name="all-beans" depends="all-openide,all-java">
    <echo message="Building module beans..."/>
    <ant dir="../beans" target="netbeans"/>
  </target>
  <target name="all-classfile" depends="all-openide">
    <echo message="Building module classfile..."/>
    <ant dir="../classfile" target="netbeans"/>
  </target>
  <target name="all-classclosure" depends="all-openide,all-classfile,all-logger">
    <echo message="Building module classclosure..."/>
    <ant dir="../classclosure" target="netbeans"/>
  </target>
  <target name="all-clazz" depends="all-openide,all-classfile">
    <echo message="Building module clazz..."/>
    <ant dir="../clazz" target="netbeans"/>
  </target>
  <target name="all-db" depends="all-openide,all-openidex,all-form">
    <echo message="Building module db..."/>
    <ant dir="../db" target="netbeans"/>
  </target>
  <target name="all-debuggercore" depends="all-openide">
    <echo message="Building module debuggercore..."/>
    <ant dir="../debuggercore" target="netbeans"/>
  </target>
  <target name="all-debuggerjpda" depends="all-openide,all-debuggercore">
    <echo message="Building module debuggerjpda..."/>
    <ant dir="../debuggerjpda" target="netbeans"/>
  </target>
  <target name="all-debuggertools" depends="all-openide,all-debuggercore">
    <echo message="Building module debuggertools..."/>
    <ant dir="../debuggertools" target="netbeans"/>
  </target>
  <!-- XXX illegal dependence on core! -->
  <target name="all-editor" depends="all-openide,all-core">
    <echo message="Building module editor..."/>
    <ant dir="../editor" target="netbeans"/>
  </target>
  <target name="all-extbrowser" depends="all-openide,all-httpserver">
    <echo message="Building module extbrowser..."/>
    <ant dir="../extbrowser" target="netbeans"/>
  </target>
  <target name="all-extbrowser/webclient" depends="all-openide,all-httpserver">
    <echo message="Building module webclient..."/>
    <ant dir="../extbrowser/webclient" target="netbeans"/>
  </target>
  <!-- XXX illegal dependence on core! -->
  <target name="all-form" depends="all-openide,all-openidex,all-java,all-clazz,all-core">
    <echo message="Building module form..."/>
    <ant dir="../form" target="netbeans"/>
  </target>
  <target name="all-freestylebrowser" depends="all-openide,all-openidex,all-beans,all-java,all-clazz">
    <echo message="Building module freestylebrowser..."/>
    <ant dir="../freestylebrowser" target="netbeans"/>
  </target>
  <target name="all-html" depends="all-openide">
    <echo message="Building module html..."/>
    <ant dir="../html" target="netbeans"/>
  </target>
  <target name="all-httpserver" depends="all-openide, all-httpserver/servletapi">
    <echo message="Building module httpserver..."/>
    <ant dir="../httpserver" target="netbeans"/>
  </target>
  <target name="all-httpserver/servletapi" depends="all-openide">
    <echo message="Building module httpserver/servletapi..."/>
    <ant dir="../httpserver/servletapi" target="netbeans"/>
  </target>
  <target name="all-i18n" depends="all-openide,all-core,all-properties,all-form">
    <echo message="Building module i18n..."/>
    <ant dir="../i18n" target="netbeans"/>
  </target>
  <target name="all-itutor" depends="all-openide,all-core">
    <echo message="Building module itutor..."/>
    <ant dir="../itutor" target="netbeans"/>
  </target>
  <target name="all-icebrowser" depends="all-openide">
    <echo message="Building module icebrowser..."/>
    <ant dir="../icebrowser" target="netbeans"/>
  </target>
  <target name="all-image" depends="all-openide">
    <echo message="Building module image..."/>
    <ant dir="../image" target="netbeans"/>
  </target>
  <target name="all-innertesters" depends="all-openide">
    <echo message="Building module innertesters..."/>
    <ant dir="../innertesters" target="netbeans"/>
  </target>
  <target name="all-j2eeserver" depends="all-openide,all-jarpackager,all-debuggercore,all-debuggerjpda">
    <echo message="Building module j2eeserver..."/>
    <ant dir="../j2eeserver" target="netbeans"/>
  </target>
  <target name="all-junit" depends="all-openide">
    <echo message="Building module junit..."/>
    <ant dir="../junit" target="netbeans"/>
  </target>
  <target name="all-jarpackager" depends="all-openide">
    <echo message="Building module jarpackager..."/>
    <ant dir="../jarpackager" target="netbeans"/>
  </target>
  <target name="all-java" depends="all-openide">
    <echo message="Building module java..."/>
    <ant dir="../java" target="netbeans"/>
  </target>
  <target name="all-javadoc" depends="all-openide,all-java">
    <echo message="Building module javadoc..."/>
    <ant dir="../javadoc" target="netbeans"/>
  </target>
  <!--
  <target name="all-javaembeddedserver" depends="all-openide,all-jarpackager,all-form">
    <echo message="Building module javaembeddedserver..."/>
    <ant dir="../javaembeddedserver" target="netbeans"/>
  </target>
  -->
  <target name="all-jini" depends="all-openide,all-httpserver">
    <echo message="Building module jini..."/>
    <ant dir="../jini" target="netbeans"/>
  </target>
  <target name="all-jndi" depends="all-openide,all-openidex">
    <echo message="Building module jndi..."/>
    <ant dir="../jndi" target="netbeans"/>
  </target>
  <target name="all-logger" depends="all-openide,all-core">
    <echo message="Building module logger..."/>
    <ant dir="../logger" target="netbeans"/>
  </target>
  <target name="all-makefile" depends="all-openide">
    <echo message="Building module makefile..."/>
    <ant dir="../makefile" target="netbeans"/>
  </target>
  <target name="all-mdr" depends="all-openide,all-openidex">
    <echo message="Building module mdr..."/>
    <ant dir="../mdr" target="netbeans"/>
  </target>
  <target name="all-multicompile" depends="all-openide">
    <echo message="Building module multicompile..."/>
    <ant dir="../multicompile" target="netbeans"/>
  </target>
  <target name="all-objectbrowser" depends="all-openide">
    <echo message="Building module objectbrowser..."/>
    <ant dir="../objectbrowser" target="netbeans"/>
  </target>
  <target name="all-openidex" depends="all-openide">
    <echo message="Building module openidex..."/>
    <ant dir="../openidex" target="netbeans"/>
  </target>
  <target name="all-projects" depends="all-openide">
    <echo message="Building module projects..."/>
    <ant dir="../projects" target="netbeans"/>
  </target>
  <target name="all-properties" depends="all-openide,all-editor">
    <echo message="Building module properties..."/>
    <ant dir="../properties" target="netbeans"/>
  </target>
  <target name="all-remotefs" depends="all-openide">
    <echo message="Building module remotefs..."/>
    <ant dir="../remotefs" target="netbeans"/>
  </target>
  <target name="all-rmi" depends="all-openide,all-java,all-debuggercore">
    <echo message="Building module rmi..."/>
    <ant dir="../rmi" target="netbeans"/>
  </target>
  <target name="all-schema2beans" depends="all-openide">
    <echo message="Building module schema2beans..."/>
    <ant dir="../schema2beans" target="netbeans"/>
  </target>
  <!-- XXX illegal dependence on core! -->
  <target name="all-scripting" depends="all-openide,all-openidex,all-core">
    <echo message="Building module scripting..."/>
    <ant dir="../scripting" target="netbeans"/>
  </target>
  <target name="all-serialversion" depends="all-openide">
    <echo message="Building module serialversion..."/>
    <ant dir="../serialversion" target="netbeans"/>
  </target>
  <target name="all-sysprops" depends="all-openide">
    <echo message="Building module sysprops..."/>
    <ant dir="../sysprops" target="netbeans"/>
  </target>
  <target name="all-text" depends="all-openide">
    <echo message="Building module text..."/>
    <ant dir="../text" target="netbeans"/>
  </target>
  <target name="all-tomcatint/tomcat32" depends="all-openide,all-web">
    <echo message="Building module tomcatint/tomcat32..."/>
    <ant dir="../tomcatint/tomcat32" target="netbeans"/>
  </target>
  <target name="all-usersguide" depends="all-openide">
    <echo message="Building module usersguide..."/>
    <ant dir="../usersguide" target="netbeans"/>
  </target>
  <target name="all-utilities" depends="all-openide,all-openidex">
    <echo message="Building module utilities..."/>
    <ant dir="../utilities" target="netbeans"/>
  </target>
  <target name="all-vcscvs" depends="all-openide,all-openidex,all-editor,all-vcscore">
    <echo message="Building module vcscvs..."/>
    <ant dir="../vcscvs" target="netbeans"/>
  </target>
  <target name="all-vcscvs/compat" depends="all-openide,all-openidex,all-editor,all-vcscore,all-vcsgeneric">
    <echo message="Building module vcscvs compat..."/>
    <ant dir="../vcscvs/compat" target="netbeans"/>
  </target>
  <target name="all-vcsgeneric" depends="all-openide,all-openidex,all-vcscore">
    <echo message="Building module vcsgeneric..."/>
    <ant dir="../vcsgeneric" target="netbeans"/>
  </target>
  <!-- XXX check editor dependecy -->
  <target name="all-vcscore" depends="all-openide,all-openidex,all-editor">
    <echo message="Building module vcscore..."/>
    <ant dir="../vcscore" target="netbeans"/>
  </target>
  <target name="all-javacvs" depends="all-openide,all-openidex,all-vcscore">
    <echo message="Building module javacvs..."/>
    <ant dir="../javacvs" target="netbeans"/>
  </target>
  <target name="all-web" depends="all-web/servletapi23,all-web/core,all-web/jspparser,all-web/jspsyntax">
    <echo message="Building module web..."/>
  </target>
  <target name="all-web/servletapi23" depends="all-web/core">
    <echo message="Building module web/servletapi23..."/>
    <ant dir="../web/servletapi23" target="netbeans"/>
  </target>
  <!-- XXX illegal dependence on core! -->
  <target name="all-web/core" depends="all-openide,all-java,all-core,all-editor,all-j2eeserver,all-html,all-httpserver,all-jarpackager,all-debuggercore,all-openidex">
    <echo message="Building module web/core..."/>
    <ant dir="../web/core" target="netbeans"/>
  </target>
  <target name="all-web/jspparser" depends="all-web/core,all-web/servletapi23">
    <echo message="Building module web/jspparser..."/>
    <ant dir="../web/jspparser" target="netbeans"/>
  </target>
  <target name="all-web/jspsyntax" depends="all-web/core">
    <echo message="Building module web/jspsyntax..."/>
    <ant dir="../web/jspsyntax" target="netbeans"/>
  </target>
  <target name="all-web/jspdebug" depends="all-web/core">
    <echo message="Building module web/jspdebug..."/>
    <ant dir="../web/jspdebug" target="netbeans"/>
  </target>
  <target name="all-web/advanced" depends="all-web/core,all-web/jspsyntax,all-jarpackager,all-debuggercore,all-xml/text-edit,all-xml/catalog,all-j2eeserver,all-schema2beans,all-classclosure,all-html,all-openidex">
    <echo message="Building module web/advanced..."/>
    <ant dir="../web/advanced" target="netbeans"/>
  </target>
  <target name="all-cpplite" depends="all-openide,all-editor,all-java">
    <echo message="Building module cpplite..."/>
    <ant dir="../cpplite" target="netbeans"/>
  </target>

  <!-- XXX illegal dependence on core! -->
  <target name="all-cpp" depends="all-openide,all-editor,all-core">
    <echo message="Building module cpp..."/>
    <ant dir="../cpp" target="netbeans"/>
  </target>

  <!-- XXX illegal dependence on core! -->
  <target name="all-externaleditor" depends="all-openide,all-editor,all-core">
    <echo message="Building module externaleditor..."/>
    <ant dir="../externaleditor" target="netbeans"/>
  </target>

  <target name="all-corba" depends="all-openide,all-editor,all-java">
    <echo message="Building module corba..."/>
    <ant dir="../corba" target="netbeans"/>
  </target>

  <target name="all-xml/tax" depends="all-openide">
      <echo message="Building module xml/tax..."/>
      <ant dir="../xml/tax" target="netbeans"/>
  </target>

  <target name="all-xml/core" depends="all-openide,all-openidex,all-xml/tax">
      <echo message="Building module xml/core..."/>
      <ant dir="../xml/core" target="netbeans"/>
  </target>

  <target name="all-xml/catalog" depends="all-openide,all-xml/core">
      <echo message="Building module xml/catalog..."/>
      <ant dir="../xml/catalog" target="netbeans"/>
  </target>

  <target name="all-xml/tools" depends="all-openide,all-xml/tax,all-xml/core">
      <echo message="Building module xml/tools..."/>
      <ant dir="../xml/tools" target="netbeans"/>
  </target>

  <target name="all-xml/text-edit" depends="all-openide,all-editor,all-xml/tax,all-xml/core">
      <echo message="Building module xml/text-edit..."/>
      <ant dir="../xml/text-edit" target="netbeans"/>
  </target>

  <target name="all-xml/tree-edit" depends="all-openide,all-openidex,all-xml/tax,all-xml/core">
      <echo message="Building module xml/tree-edit..."/>
      <ant dir="../xml/tree-edit" target="netbeans"/>
  </target>

  <target name="all-xml/css" depends="all-openide,all-editor">
      <echo message="Building module xml/css..."/>
      <ant dir="../xml/css" target="netbeans"/>
  </target>

  <target name="all-xml" depends="all-xml/tax,all-xml/core,all-xml/catalog,all-xml/tools,all-xml/text-edit,all-xml/tree-edit,all-xml/css"/>

  <target name="all-treefs" depends="all-openide">
    <echo message="Building module treefs..."/>
    <ant dir="../treefs" target="netbeans"/>
  </target>

  <target name="build-messaging" depends="init">
    <echo message="Starting a build for NetBeans (build ${buildnum}, config '${moduleconfig}') ..."/>
    <echo message="Selected modules: ${modules}"/>
    <echo message="OS: ${os.name} ${os.version}  Locale: ${user.language}_${user.region}"/>
    <echo message="Java: ${java.vendor} ${java.version} in ${java.home}; for NetBeans: ${jdkhome}"/>
    <echo message="Classpath: ${java.class.path}"/>
  </target>

  <!-- Use of nbmerge target has the effect of automatically depending on all-X for every module. -->
  <!-- It also runs deltree(dir=wherever) and copydir(src=../X/netbeans,dest=wherever) to create the IDE install. -->

  <target name="build-nozip" depends="delete-and-merge" description="Build the IDE but do not create a final ZIP file.">
    <taskdef name="createmodulexml" classname="org.netbeans.nbbuild.CreateModuleXML" classpath="nbantext.jar"/>
    <mkdir dir="${netbeans.dest}/system/Modules"/>
    <mkdir dir="${netbeans.dest}/modules/autoload"/>
    <createmodulexml xmldir="${netbeans.dest}/system/Modules">
      <enabled dir="${netbeans.dest}/modules">
        <include name="*.jar"/>
        <!-- Just to test that we can in fact preconfigure some disabled modules: -->
        <exclude name="icebrowser.jar"/>
      </enabled>
      <disabled dir="${netbeans.dest}/modules">
        <include name="icebrowser.jar"/>
      </disabled>
      <autoload dir="${netbeans.dest}/modules/autoload">
        <include name="*.jar"/>
      </autoload>
    </createmodulexml>
    <echo file="${netbeans.dest}/build_info">NetBeans dev build
------------------
Number:   ${buildnumber}
Date:     ${TODAY}
Branding:
Branch:   trunk
Tag:
</echo>
  </target>

  <target name="build" depends="build-nozip"
          description="Create a complete build (but do not try it).">
    <!-- zip task not well suited to making final build, as it does not set +x bits -->
    <!-- so on Unix try to use native ZIP first -->
    <delete file="NetBeans-${buildnum}.zip"/>
    <exec executable="zip" dir="." os="Linux SunOS Solaris" failonerror="false">
      <arg value="-r"/>
      <arg value="NetBeans-${buildnum}.zip"/>
      <arg value="${netbeans.dest}"/>
    </exec>
    <zip zipfile="NetBeans-${buildnum}.zip" basedir=".">
      <include name="${netbeans.dest}/"/>
    </zip>
    <echo>Build created; see NetBeans-${buildnum}.zip (in nbbuild/).
If you like, you may run the IDE straight from
the ${netbeans.dest}/bin/ directory.
(For example, type: ant tryme)
</echo>
  </target>

  <target name="delete-and-merge" depends="merge-delete,merge" />   

  <target name="merge-delete" depends="init">
    <delete dir="${netbeans.dest}" />
  </target>
  
  <target name="merge" depends="init,build-messaging">
    <mkdir dir="${netbeans.dest}"/>
    <nbmerge dest="${netbeans.dest}" topdir=".." modules="${fixedmodules},${modules}" targetprefix="all-">
      <suppress locale="ja" unless="netbeans.japanese"/>
    </nbmerge>
    <chmod perm="ugo+x">
      <fileset dir="${netbeans.dest}/bin">
        <include name="**/*.sh"/>
        <include name="fastjavac/fastjavac.linux"/>
        <include name="fastjavac/fastjavac.sun"/>
        <include name="fastjavac/fastjavac.sun.intel"/>
      </fileset>
    </chmod>
  </target>

  <target name="sanity-check" depends="testuserdir-delete,sanity-start" description="Test whether the build can start up without problems."/>
  <target name="testuserdir-delete" depends="init">
    <delete dir="${test.user.dir}"/>
  </target>
  <target name="sanity-start" depends="init,maybe-build-nozip">
    <mkdir dir="${test.user.dir}"/>
    <echo>Starting the IDE as a sanity check...</echo>
    <!-- XXX better would be to scan start log for stacktraces and just show those; -->
    <!-- possibly after filtering for duplicates or something like this. -->
    <!-- Timeout is ten minutes; should be enough for valid start, while preventing -->
    <!-- a deadlock from hanging an automated build: -->
    <exec os="Windows NT Windows 95 Windows 98 Windows 2000" executable="${netbeans.dest}/bin/runide.exe" failonerror="yes" timeout="600000">
      <arg value="-jdkhome"/>
      <arg file="${jdkhome}"/>
      <arg value="-userdir"/>
      <arg file="${test.user.dir}"/>
      <arg line="${sanitystart.args}"/>
    </exec>
    <exec os="Linux SunOS Solaris" dir="." executable="sh" failonerror="yes" timeout="600000">
      <arg value="${netbeans.dest}/bin/runide.sh"/>
      <arg value="-jdkhome"/>
      <arg file="${jdkhome}"/>
      <arg value="-userdir"/>
      <arg file="${test.user.dir}"/>
      <arg line="${sanitystart.args}"/>
    </exec>
    <echo>Finished starting the IDE, pay attention to any reported errors.</echo>
  </target>

  <target name="check-for-build">
    <available property="have-build" file="${netbeans.dest}/lib/openide.jar"/>
  </target>
  <target name="maybe-build-nozip" depends="check-for-build" unless="have-build">
    <ant dir="." target="build-nozip"/>
  </target>

  <target name="tryme" depends="init,maybe-build-nozip"
          description="Try running the IDE interactively (build it first if needed).">
    <exec os="Windows NT Windows 95 Windows 98 Windows 2000" executable="${netbeans.dest}/bin/runide.exe" failonerror="yes">
      <arg value="-jdkhome"/>
      <arg file="${jdkhome}"/>
      <arg value="-userdir"/>
      <arg file="${test.user.dir}"/>
      <arg line="${tryme.args}"/>
    </exec>
    <exec os="Linux SunOS Solaris" dir="." executable="sh" failonerror="yes">
      <arg value="${netbeans.dest}/bin/runide.sh"/>
      <arg value="-jdkhome"/>
      <arg file="${jdkhome}"/>
      <arg value="-userdir"/>
      <arg file="${test.user.dir}"/>
      <arg line="${tryme.args}"/>
    </exec>
  </target>

  <target name="update-info" depends="init,all-openide,all-core"
          description="Build Auto Update NBM files and XML descriptions.">
    <!-- Note: partially sorted in dependency order -->
    <!-- (this could also be done with separate targets). -->
    <echo message="Making NBM for module ant..."/>
    <ant dir="../ant" target="nbm"/>
    <echo message="Making NBM for module openidex..."/>
    <ant dir="../openidex" target="nbm"/>
    <echo message="Making NBM for module debuggercore..."/>
    <ant dir="../debuggercore" target="nbm"/>
    <echo message="Making NBM for module applet..."/>
    <ant dir="../applet" target="nbm"/>
    <echo message="Making NBM for module autoupdate..."/>
    <ant dir="../autoupdate" target="nbm"/>
    <echo message="Making NBM for module java..."/>
    <ant dir="../java" target="nbm"/>
    <echo message="Making NBM for module beans..."/>
    <ant dir="../beans" target="nbm"/>
    <echo message="Making NBM for module clazz..."/>
    <ant dir="../clazz" target="nbm"/>
    <echo message="Making NBM for module debuggerjpda..."/>
    <ant dir="../debuggerjpda" target="nbm"/>
    <echo message="Making NBM for module debuggertools..."/>
    <ant dir="../debuggertools" target="nbm"/>
    <echo message="Making NBM for module editor..."/>
    <ant dir="../editor" target="nbm"/>
    <echo message="Making NBM for module form..."/>
    <ant dir="../form" target="nbm"/>
    <echo message="Making NBM for module html..."/>
    <ant dir="../html" target="nbm"/>
    <echo message="Making NBM for module httpserver/servletapi..."/>
    <ant dir="../httpserver/servletapi" target="nbm"/>
    <echo message="Making NBM for module httpserver..."/>
    <ant dir="../httpserver" target="nbm"/>
    <echo message="Making NBM for module properties..."/>
    <ant dir="../properties" target="nbm"/>
    <echo message="Making NBM for module web/core..."/>
    <ant dir="../web/core" target="nbm"/>
    <echo message="Making NBM for module web/jspsyntax..."/>
    <ant dir="../web/jspsyntax" target="nbm"/>
    <echo message="Making NBM for module i18n..."/>
    <ant dir="../i18n" target="nbm"/>
    <echo message="Making NBM for module icebrowser..."/>
    <ant dir="../icebrowser" target="nbm"/>
    <echo message="Making NBM for module image..."/>
    <ant dir="../image" target="nbm"/>
    <echo message="Making NBM for module innertesters..."/>
    <ant dir="../innertesters" target="nbm"/>
    <echo message="Making NBM for module jarpackager..."/>
    <ant dir="../jarpackager" target="nbm"/>
    <echo message="Making NBM for module jndi..."/>
    <ant dir="../jndi" target="nbm"/>
    <echo message="Making NBM for module apisupport..."/>
    <ant dir="../apisupport" target="nbm"/>
    <echo message="Making NBM for module javadoc..."/>
    <ant dir="../javadoc" target="nbm"/>
    <!--
    <echo message="Making NBM for module javaembeddedserver..."/>
    <ant dir="../javaembeddedserver" target="nbm"/>
    -->
    <echo message="Making NBM for module jini..."/>
    <ant dir="../jini" target="nbm"/>
    <echo message="Making NBM for module makefile..."/>
    <ant dir="../makefile" target="nbm"/>
    <echo message="Making NBM for module multicompile..."/>
    <ant dir="../multicompile" target="nbm"/>
    <echo message="Making NBM for module objectbrowser..."/>
    <ant dir="../objectbrowser" target="nbm"/>
    <echo message="Making NBM for module projects..."/>
    <ant dir="../projects" target="nbm"/>
    <echo message="Making NBM for module remotefs..."/>
    <ant dir="../remotefs" target="nbm"/>
    <echo message="Making NBM for module rmi..."/>
    <ant dir="../rmi" target="nbm"/>
    <!-- Not for now (binaries issues):
    <echo message="Making NBM for module scripting..."/>
    <ant dir="../scripting" target="nbm"/>
    -->
    <echo message="Making NBM for module serialversion..."/>
    <ant dir="../serialversion" target="nbm"/>
    <echo message="Making NBM for module sysprops..."/>
    <ant dir="../sysprops" target="nbm"/>
    <echo message="Making NBM for module text..."/>
    <ant dir="../text" target="nbm"/>
    <echo message="Making NBM for module usersguide..."/>
    <ant dir="../usersguide" target="nbm"/>
    <echo message="Making NBM for module utilities..."/>
    <ant dir="../utilities" target="nbm"/>
    <echo message="Making NBM for module vcscvs..."/>
    <ant dir="../vcscvs" target="nbm"/>
    <echo message="Making NBM for module vcsgeneric..."/>
    <ant dir="../vcsgeneric" target="nbm"/>
    <makeupdatedesc desc="../www/www/updates/40_1.1_.xml">
      <!-- Not for now:
      <group name="Standard">
        <fileset dir=".">
          <include name="../applet/applet.nbm"/>
          <include name="../autoupdate/autoupdate.nbm"/>
          <include name="../beans/beans.nbm"/>
          <include name="../clazz/clazz.nbm"/>
          <include name="../debuggercore/debuggercore.nbm"/>
          <include name="../debuggerjpda/debuggerjpda.nbm"/>
          <include name="../debuggertools/debuggertools.nbm"/>
          <include name="../editor/editor.nbm"/>
          <include name="../form/form.nbm"/>
          <include name="../html/html.nbm"/>
          <include name="../httpserver/httpserver.nbm"/>
          <include name="../i18n/i18n.nbm"/>
          <include name="../icebrowser/icebrowser.nbm"/>
          <include name="../image/image.nbm"/>
          <include name="../jarpackager/jarpackager.nbm"/>
          <include name="../java/java.nbm"/>
          <include name="../javadoc/javadoc.nbm"/>
          <include name="../jndi/jndi.nbm"/>
          <include name="../objectbrowser/objectbrowser.nbm"/>
          <include name="../openidex/openidex.nbm"/>
          <include name="../projects/projects.nbm"/>
          <include name="../properties/properties.nbm"/>
          <include name="../rmi/rmi.nbm"/>
          <include name="../text/text.nbm"/>
          <include name="../usersguide/usersguide.nbm"/>
          <include name="../utilities/utilities.nbm"/>
          <include name="../vcscvs/vcscvs.nbm"/>
          <include name="../vcsgeneric/vcsgeneric.nbm"/>
	<!- Careful! ->
          <include name="../web/web-jsp.nbm"/>
          <include name="../web/web-wizard.nbm"/>
        </fileset>
      </group>
      -->
      <group name="Extensions">
        <fileset dir=".">
          <include name="../apisupport/apisupport.nbm"/>
          <include name="../innertesters/innertesters.nbm"/>
          <include name="../makefile/makefile.nbm"/>
        </fileset>
      </group>
      <group name="Experimental">
        <fileset dir=".">
          <include name="../ant/ant.nbm"/>
        <!--
          <include name="../javaembeddedserver/javaembeddedserver.nbm"/>
        -->
          <include name="../jini/jini.nbm"/>
          <include name="../multicompile/multicompile.nbm"/>
          <include name="../remotefs/remotefs.nbm"/>
        <!-- Not for now (binary redistribution issues):
          <include name="../scripting/scripting.nbm"/>
        -->
          <include name="../serialversion/serialversion.nbm"/>
          <include name="../sysprops/sysprops.nbm"/>
        </fileset>
      </group>
    </makeupdatedesc>
  </target>

  <target name="update-info33me" depends="init,all-openide,all-core,update-info"
          description="Build Auto Update NBM files and XML descriptions.">
    <!-- Note: partially sorted in dependency order -->
    <!-- (this could also be done with separate targets). -->
    <echo message="Making NBM for module ant..."/>
    <ant dir="../ant" target="nbm"/>
    <echo message="Making NBM for module openidex..."/>
    <ant dir="../openidex" target="nbm"/>
    <echo message="Making NBM for module debuggercore..."/>
    <ant dir="../debuggercore" target="nbm"/>
    <echo message="Making NBM for module debuggerjpda..."/>
    <ant dir="../debuggerjpda" target="nbm"/>
    <echo message="Making NBM for module debuggertools..."/>
    <ant dir="../debuggertools" target="nbm"/>
    <echo message="Making NBM for module applet..."/>
    <ant dir="../applet" target="nbm"/>
    <echo message="Making NBM for module autoupdate..."/>
    <ant dir="../autoupdate" target="nbm"/>
    <echo message="Making NBM for module java..."/>
    <ant dir="../java" target="nbm"/>
    <echo message="Making NBM for module beans..."/>
    <ant dir="../beans" target="nbm"/>
    <echo message="Making NBM for module classfile..."/>
    <ant dir="../classfile" target="nbm"/>
    <echo message="Making NBM for module clazz..."/>
    <ant dir="../clazz" target="nbm"/>
    <echo message="Making NBM for module debuggerjpda..."/>
    <ant dir="../debuggerjpda" target="nbm"/>
    <echo message="Making NBM for module debuggertools..."/>
    <ant dir="../debuggertools" target="nbm"/>
    <echo message="Making NBM for module editor..."/>
    <ant dir="../editor" target="nbm"/>
    <echo message="Making NBM for module form..."/>
    <ant dir="../form" target="nbm"/>
    <echo message="Making NBM for module html..."/>
    <ant dir="../html" target="nbm"/>
    <echo message="Making NBM for module httpserver/servletapi..."/>
    <ant dir="../httpserver/servletapi" target="nbm"/>
    <echo message="Making NBM for module httpserver..."/>
    <ant dir="../httpserver" target="nbm"/>
    <echo message="Making NBM for module extbrowser..."/>
    <ant dir="../extbrowser" target="nbm"/>
    <echo message="Making NBM for module properties..."/>
    <ant dir="../properties" target="nbm"/>
    <echo message="Making NBM for module jarpackager..."/>
    <ant dir="../jarpackager" target="nbm"/>
    <echo message="Making NBM for module j2eeserver..."/>
    <ant dir="../j2eeserver" target="nbm"/>
    <echo message="Making NBM for module web/core..."/>
    <ant dir="../web/core" target="nbm"/>
    <echo message="Making NBM for module web/jspsyntax..."/>
    <ant dir="../web/jspsyntax" target="nbm"/>
    <echo message="Making NBM for module tomcatint..."/>
    <ant dir="../tomcatint" target="nbm"/>
    <echo message="Making NBM for module i18n..."/>
    <ant dir="../i18n" target="nbm"/>
<!--
    <echo message="Making NBM for module icebrowser..."/>
    <ant dir="../icebrowser" target="nbm"/>
-->
    <echo message="Making NBM for module image..."/>
    <ant dir="../image" target="nbm"/>
<!--
    <echo message="Making NBM for module innertesters..."/>
    <ant dir="../innertesters" target="nbm"/>
-->
    <echo message="Making NBM for module jndi..."/>
    <ant dir="../jndi" target="nbm"/>
    <echo message="Making NBM for module apisupport..."/>
    <ant dir="../apisupport" target="nbm"/>
    <echo message="Making NBM for module apisupport/lite..."/>
    <ant dir="../apisupport/lite" target="nbm"/>
    <echo message="Making NBM for module javadoc..."/>
    <ant dir="../javadoc" target="nbm"/>
<!--
    <echo message="Making NBM for module javaembeddedserver..."/>
    <ant dir="../javaembeddedserver" target="nbm"/>
    <echo message="Making NBM for module jini..."/>
    <ant dir="../jini" target="nbm"/>
    <echo message="Making NBM for module makefile..."/>
    <ant dir="../makefile" target="nbm"/>
    <echo message="Making NBM for module multicompile..."/>
    <ant dir="../multicompile" target="nbm"/>
    <echo message="Making NBM for module objectbrowser..."/>
    <ant dir="../objectbrowser" target="nbm"/>
-->
    <echo message="Making NBM for module projects..."/>
    <ant dir="../projects" target="nbm"/>
<!--
    <echo message="Making NBM for module remotefs..."/>
    <ant dir="../remotefs" target="nbm"/>
-->
    <echo message="Making NBM for module rmi..."/>
    <ant dir="../rmi" target="nbm"/>
<!-- Not for now (binaries issues): -->
    <echo message="Making NBM for module scripting..."/>
    <ant dir="../scripting" target="nbm"/>
<!-- -->
<!--
    <echo message="Making NBM for module serialversion..."/>
    <ant dir="../serialversion" target="nbm"/>
    <echo message="Making NBM for module sysprops..."/>
    <ant dir="../sysprops" target="nbm"/>
-->
    <echo message="Making NBM for module text..."/>
    <ant dir="../text" target="nbm"/>
    <echo message="Making NBM for module usersguide..."/>
    <ant dir="../usersguide" target="nbm"/>
    <echo message="Making NBM for module utilities..."/>
    <ant dir="../utilities" target="nbm"/>
    <echo message="Making NBM for module vcscore..."/>
    <ant dir="../vcscore" target="nbm"/>
<!-- 
    <echo message="Making NBM for module vcscvs..."/>
    <ant dir="../vcscvs" target="nbm"/>
-->
    <echo message="Making NBM for module vcsgeneric..."/>
    <ant dir="../vcsgeneric" target="nbm"/>
    <echo message="Making NBM for module vcscvs/compat..."/>
    <ant dir="../vcscvs/compat" target="nbm"/>
    <echo message="Making NBM for module javacvs..."/>
    <ant dir="../javacvs" target="nbm"/>
    <makeupdatedesc desc="../www/www/updates/33me_1.5_.xml">
      <entityinclude file="33_1.5_.ent"/>
      <!-- Not for now: -->
      <group name="Standard">
        <fileset dir=".">
          <include name="../ant/ant.nbm"/>
          <include name="../apisupport/apisupport-lite.nbm"/>
          <include name="../apisupport/apisupport.nbm"/>
          <include name="../applet/applet.nbm"/>
          <include name="../autoupdate/autoupdate.nbm"/>
          <include name="../beans/beans.nbm"/>
          <include name="../classfile/classfile.nbm"/>
          <include name="../clazz/clazz.nbm"/>
          <include name="../debuggercore/debuggercore.nbm"/>
          <include name="../debuggerjpda/debuggerjpda.nbm"/>
          <include name="../debuggertools/debuggertools.nbm"/>
          <include name="../editor/editor.nbm"/>
          <include name="../form/form.nbm"/>
          <include name="../html/html.nbm"/>
          <include name="../httpserver/httpserver.nbm"/>
          <include name="../httpserver/servletapi/servletapi.nbm"/>
          <include name="../i18n/i18n.nbm"/>
          <include name="../extbrowser/extbrowser.nbm"/>
          <include name="../image/image.nbm"/>
          <include name="../j2eeserver/j2eeserver.nbm"/>
          <include name="../jarpackager/jarpackager.nbm"/>
          <include name="../java/java.nbm"/>
          <include name="../javacvs/javacvs.nbm"/>
          <include name="../javadoc/javadoc.nbm"/>
          <include name="../jndi/jndi.nbm"/>
<!--
          <include name="../objectbrowser/objectbrowser.nbm"/>
-->
          <include name="../openidex/openidex.nbm"/>
          <include name="../projects/projects.nbm"/>
          <include name="../properties/properties.nbm"/>
          <include name="../rmi/rmi.nbm"/>
          <include name="../text/text.nbm"/>
          <include name="../tomcatint/tomcat32/web-jsp-tomcat.nbm"/>
          <include name="../usersguide/usersguide.nbm"/>
          <include name="../utilities/utilities.nbm"/>
          <include name="../vcscore/vcscore.nbm"/>
          <include name="../vcscvs/compat/vcscvscompat.nbm"/>
          <include name="../vcsgeneric/vcsgen.nbm"/>
	<!-- Careful! -->
          <include name="../web/core/web-jsp.nbm"/>
          <include name="../web/jspsyntax/web-jspsyntax.nbm"/>
          <include name="../scripting/scripting.nbm"/>
        </fileset>
      </group>
<!-- 
      <group name="Extensions">
<!-
        <fileset dir=".">
          <include name="../innertesters/innertesters.nbm"/>
          <include name="../makefile/makefile.nbm"/>
        </fileset>
->
      </group>
-->
<!--
      <group name="Experimental">
<!-
        <fileset dir=".">
          <include name="../javaembeddedserver/javaembeddedserver.nbm"/>
        </fileset>
->

<!-
        <fileset dir=".">
          <include name="../jini/jini.nbm"/>
          <include name="../multicompile/multicompile.nbm"/>
          <include name="../remotefs/remotefs.nbm"/>
        </fileset>
->

<!- Not for now (binary redistribution issues): ->
<!- ->

<!-
        <fileset dir=".">
          <include name="../serialversion/serialversion.nbm"/>
          <include name="../sysprops/sysprops.nbm"/>
        </fileset>
->
      </group>
-->
    </makeupdatedesc>
  </target>

  <target name="bootstrap-javadoc"
          depends="check-for-binaries"
          description="Generate Javadoc for Ant extensions.">
    <mkdir dir="www/nbantext-javadoc"/>
    <tstamp/>
    <!-- XXX if there is org.apache.tools.ant.* docs online, link to them -->
    <javadoc sourcepath="antsrc"
             destdir="www/nbantext-javadoc"
             packagenames="org.netbeans.nbbuild.*"
             windowtitle="NetBeans Ant Extensions"
             doctitle="Extended Ant Tasks for Building NetBeans"
             nodeprecatedlist="true"
             notree="true"
             noindex="true"
             nohelp="true"
             nonavbar="true"
             author="false"
             version="false"
             bottom="Built on ${TODAY}"
    >
      <classpath>
        <!-- Needed for CheckLinks: -->
        <pathelement location="${binroot}/core/release/lib/ext/regexp.jar"/>
        <!-- For running inside IDE, to pick up ant.jar -->
        <pathelement location="${binroot}/nbbuild/lib/ant.jar"/>
        <pathelement location="${binroot}/core/release/lib/ext/xerces.jar"/>
        <pathelement location="${binroot}/nbbuild/lib/jhall.jar"/>
      </classpath>
    </javadoc>
  </target>

  <target name="real-clean" depends="clean"
          description="Clean everything possible.">
    <echo message="Cleaning old builds..."/>
    <delete>
      <fileset dir=".">
        <include name="NetBeans-*.log"/>
        <include name="NetBeans-*.zip"/>
      </fileset>
    </delete>
    <!-- This step must be last: -->
    <echo message="Cleaning NetBeans-specific Ant extensions..."/>
    <delete file="nbantext.jar"/>
    <delete>
      <fileset dir="antsrc">
        <include name="**/*.class"/>
      </fileset>
    </delete>
  </target>

  <target name="localclean" depends="init">
    <delete dir="${netbeans.dest}"/>
    <delete dir="${test.user.dir}"/>
  </target>

  <target name="clean" depends="init,localclean"
          description="Clean out (almost) all build products.">
    <cleanall topdir=".." modules="${fixedmodules},${modules}" targetname="clean"/>
    <echo message="Run `ant real-clean' if desired."/>
  </target>

  <target name="print-selected-modules" depends="init" description="Prints list of modules to build in selected moduleconfig.">
    <echo message="modules=${fixedmodules},${modules}"/>
  </target>
</project>
