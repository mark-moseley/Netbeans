<?xml version="1.0" encoding="UTF-8"?>
<!-- You may freely edit this file. See harness/README in the NetBeans platform -->
<!-- for some information on what you could do (e.g. targets to override). -->
<!-- If you delete this file and reopen the project it will be recreated. -->
<project name="org.netbeans.modules.visualweb.xhtml" default="netbeans" basedir=".">
    <description>Builds, tests, and runs the project org.netbeans.modules.visualweb.xhtml.</description>
    <import file="../../nbbuild/templates/projectized.xml"/>
    
    <property name="generated.dir" value="generated"/>
    <property name="src.dir" value="src"/>
    <property name="build.dir" value="build"/>
        
    <!-- Override target init to include the additional component generation -->
    <target name="init" depends="projectized.init, generate"/>
  
    <!-- Generate the extra XHTM Components -->
    <target name="generate">
        <path id="webui-dt.jars">
            <pathelement location="${cluster}/modules/ext/webui-dt.jar"/>
        </path>    
        <path id="digester.jars">
            <pathelement location="${cluster}/modules/ext/commons-beanutils.jar"/>
            <pathelement location="${cluster}/modules/ext/commons-digester.jar"/>
        </path>
        
        <path id="jsf.jars">
            <pathelement location="${netbeans.dest.dir}/ide8/modules/ext/commons-logging-1.0.4.jar"/>
            <pathelement location="${cluster}/modules/ext/commons-collections.jar"/>
            <pathelement location="${netbeans.dest.dir}/enterprise2/modules/ext/servlet-api-2.4.jar"/>
            <pathelement location="${cluster}/modules/ext/jsp-api.jar"/>
            <pathelement location="${cluster}/modules/ext/jstl.jar"/>
            <pathelement location="${cluster}/modules/ext/jsf-api.jar"/>
            <pathelement location="${cluster}/modules/ext/jsf-impl.jar"/>
        </path>
        
        <java classname="com.sun.rave.jsfmeta.generators.Main" 
            failonerror="true"
            fork="true">
            <arg line="-d ${generated.dir}"/>
            <arg line="-f file:src/org/netbeans/modules/visualweb/xhtml/xhtml-tags-renderkit.xml"/>
            <arg line="-c com.sun.rave.designtime.base.CategoryDescriptors"/>
            <arg line="--cpBeanInfo"/>
            <classpath>
                <pathelement path="${cluster}/modules/ext/jsf-metadata.jar"/>
                <path refid="digester.jars"/>
                <path refid="jsf.jars"/>
                <path refid="webui-dt.jars"/>
            </classpath>
        </java>
    </target>
    
    <target name="compile" depends="init">
        <mkdir dir="${build.classes.dir}"/>
        <condition property="javac.target" value="${javac.source}">
            <not>
                <isset property="javac.target"/>
            </not>
        </condition>
        <javac srcdir="${src.dir};${generated.dir}" destdir="${build.classes.dir}" debug="${build.compiler.debug}" debuglevel="${build.compiler.debuglevel}" deprecation="${build.compiler.deprecation}" optimize="${build.compiler.optimize}" source="${javac.source}" target="${javac.target}" includeantruntime="false">
            <classpath refid="cp"/>
        </javac>
         
        <!-- OK, continue: -->
        <copy todir="${build.classes.dir}">
            <!-- #58298: strip comments to save some space -->
            <fileset dir="${src.dir}" includes="**/*.properties"/>
            <fileset dir="${generated.dir}" includes="**/*.properties"/>
            <filterchain>
                <tokenfilter>
                    <!-- #61965: preserve #NOI18N and similar comments -->
                    <filetokenizer/>
                    <replaceregex pattern="^#(?!(PART)?(NO)?I18N).*[\r\n]+" replace="" flags="gm"/>
                </tokenfilter>
            </filterchain>
        </copy>
        <copy todir="${build.classes.dir}">
            <fileset dir="${src.dir}" excludes="${jar-excludes}"/>
            <fileset dir="${generated.dir}" excludes="${jar-excludes}"/>
        </copy>
    </target>
    
    <target name="clean" depends="projectized-common.clean" description="Clean the build and generated directory.">
        <delete failonerror="false" includeemptydirs="true" dir="${generated.dir}"/>
        <delete failonerror="false" includeemptydirs="true" dir="${build.dir}"/>
    </target>

</project>
