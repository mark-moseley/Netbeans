<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>
    <head>
        <title>Page Title</title>
        <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
        <style type="text/css">
            body{
                font: 10pt Verdana, sans-serif;
                color: navy;
            }
            .category{
                cursor: pointer;
                display: block;        
            }
            .item{
                display: none;
                margin-left: 16px;
                color: #FFFFFF;
            }
            a{
                text-decoration: none;
                color: #FFFFFF;
            }
            a:hover{
                text-decoration: underline;
            }

            a:visited{
                font-weight: bolder;
            }

            .outerBorder {
                margin: 0px 20px 30px 20px;
                padding: 0 10px 10px 10px;
            }

            .header {
                height:20%;
            }

            .subheader {
                clear:both;
                height: 50px;
                background-color: #006699;
                color: #FFFFFF;
                font-size:11px;
            }

            .subheader div {
                float:right;
            }

            .main {
                position: relative;
                width: 100%;
                margin-top: -10px;
            }

            .content {
                margin: 0 0 0 0px;
                height: 700px;
                background-color: #9999FF;
                color: #000000;
            }

            .details {
                margin: 0 0 0 20px;
            }

            .leftSidebar {
                float: left; 
                height: 700px;
                width: 200px;
                font-size: 10px;
                background-color: #6699CC;
                color: #FFFFFF;
            }

            .banner {
                vertical-align:middle;
                font-size:25px;
                background-color: #006699;
                color: #FFFFFF;  
                width: 100%;
            }        

            .tableheader {
                background-color: #006699;
                color: #FFFFFF;
            }
            .results
            {
                width: 600px;
            }
            .results .col
            {
                width: 20%;
                float: left;
                margin-top: 0px;
            }
            .results .resultHeader
            {
                background-color: #164A78;
                color: #FF9933;
                font-family: Arial, Verdana, Helvetica;
                font-size: 11px;
            }
            .results
            {
                margin-left: 0%;
                border: 1px solid #e0e7ec;
                font: bold 90% verdana, arial;
            }
        </style>
        <script language="Javascript">
            var doc;            
            var app;
            var baseURL = "___BASE_URL___restbean";
            var wadlURL = baseURL+"/application.wadl";  
            
            function xmlhttpGet(strURL, mimeType, type) {
                //alert(strURL);
                //log('xmlhttpGet');
                //    alert("url: " +strURL+" mime: "+mimeType);
                var xmlHttpReq;// = getXmlHttpRequest();
                if (window.XMLHttpRequest) { // Mozilla, Safari, ...
                    xmlHttpReq = new XMLHttpRequest();
                } else if (window.ActiveXObject) { // IE
                    xmlHttpReq = new ActiveXObject("Microsoft.XMLHTTP");
                }
                //    req.onprogress = onProgress;
                //log(xmlHttpReq);
                //updatepage('request', strURL);
                try {
                    xmlHttpReq.open('GET', strURL, true);
                } catch( e ) {
                    alert('Error: Permission denied to call method XMLHttpRequest.open: ' + strURL+'. Click OK and see instructions on this page.');
                    return false;
                }
                log("mimeType: "+mimeType);
                if (mimeType != null)
                    xmlHttpReq.setRequestHeader('Accept', mimeType);
                //    self.xmlHttpReq.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
                //alert(type);
                if(type == 'menu')
                    xmlHttpReq.onreadystatechange = function() { updateMenu(xmlHttpReq); };
                else
                    xmlHttpReq.onreadystatechange = function() { updateContent(xmlHttpReq); };
                xmlHttpReq.send(null);
                //alert("end");
                return true;
            }
            function updateMenu(xmlHttpReq) {                
                try {
                    if (xmlHttpReq.readyState == 4) {
                        var rtext = xmlHttpReq.responseText;
                        //alert("["+rtext+"]");                        
                        if(rtext == undefined || rtext == "" || rtext.indexOf("HTTP Status") != -1) {
                            //var err = '<font color="red">Cannot access:</font> '+wadlURL+ '<br/>Please restart your REST application and refresh this page.';
                            //alert(err);
                            //document.getElementById('subheader').innerHTML = '<br/>'+err;     
                            var newUrl = prompt('Cannot access WADL: Please restart your REST application or specify correct base URL, and refresh this page.', baseURL);
                            if(newUrl != null && baseURL != newUrl) {
                                baseURL = newUrl;
                                wadlURL = baseURL+"/application.wadl";
                                //alert(baseURL);
                                init();
                            }
                            return;
                        }
                        //alert("[here]");
                        setvisibility('main', 'inherit');
                        document.getElementById('subheader').innerHTML = '<br/><b>WADL: </b>'+wadlURL;
                        doc = loadXml(rtext);
                        if(doc != null) {
                            app=doc.documentElement;
                            var myTree = new tree();  
                            var rs;
                            if(app != null) {
                                rs = app.getElementsByTagName('resources')[0];
                                var context = rs.attributes.getNamedItem('base').nodeValue;
                                var begin = context.indexOf('/', 7);
                                if(begin != -1)
                                    context = context.substring(begin, context.length);
                                var resources = new category(rs.nodeName, context);
                                myTree.add(resources);
                                //alert(rs.attributes.length);
                                var rarr = rs.getElementsByTagName('resource');
                                for(i=0;i<rarr.length;i++) {
                                    var r = rarr[i];   
                                    //alert("[here6]"+r.nodeName);
                                    var path = r.attributes.getNamedItem('path');
                                    //alert(path.nodeValue);
                                    var start = new category(path.nodeValue,path.nodeValue);                                        
                                    var methods = r.getElementsByTagName('method');                                        
                                    for(j=0;j<methods.length;j++) {
                                        //alert('showRightSideBar(\''+app.nodeName+'/'+rs.nodeName+'/'+r.nodeName+'\', '+i+', '+j+')');
                                        var m = methods[j];
                                        var mName = m.attributes.getNamedItem("name").nodeValue;
                                        //alert("ri:"+r.nodeName);
                                        //alert("mi:"+m.nodeName);
                                        var methodst = new item(mName,'showRightSideBar(\''+app.nodeName+'/'+rs.nodeName+'/'+r.nodeName+'\', '+i+', '+j+')');
                                        start.add(methodst);
                                    }
                                    resources.add(start);
                                }
                            }                            
                            var treeString = myTree.toString();                            
                            document.getElementById('leftSidebar').innerHTML = treeString;
                        }
                    } else {
                        log("state: "+xmlHttpReq.readyState);
                    }
                } catch( e ) {
                    alert('Caught Exception1: ' + e.description);
                }
            }
            function setvisibility(id, state) {
                try {
                    document.getElementById(id).style.visibility = state;
                } catch(e) {}
            }
            function showRightSideBar(path, ri, mi) {                
                //alert("path: "+path);
                updatepage('result', '');
                var app1 = doc.documentElement;
                var rs = app1.getElementsByTagName('resources')[0];
                var r = rs.getElementsByTagName('resource')[ri];
                //alert("r: "+r.nodeName);
                var m = r.getElementsByTagName('method')[mi];
                var req = m.getElementsByTagName('request');
                var response = m.getElementsByTagName('response');
                var str = "Resource: "+r.attributes.getNamedItem('path').nodeValue+"&nbsp;&nbsp;&nbsp;Method: "+m.attributes.getNamedItem("name").nodeValue;
                //alert("str: "+str);
                str += "<br/><br/>";
                if(req != null && req.length > 0) 
                    str += "<b>Resource Inputs:</b><br><br>";
                str += "<form action='' method=GET name='form1'>";
                //alert("mi:"+m.nodeName);                
                if(req != null) {                    
                    for(i=0;i<req.length;i++) {
                        var params = req[i].getElementsByTagName('param');
                        if(params != null) {
                            for(j=0;j<params.length;j++) {
                                var pname = params[j].attributes.getNamedItem('name').nodeValue;
                                //alert(pname);
                                var num = j+1;
                                str += "<b>Param"+num+":</b><input id='params' name='"+pname+"' type='text' value='"+pname+"'><br><br>";
                            }
                        }
                    }
                }
                var path = r.attributes.getNamedItem('path').nodeValue;
                str += "<input name='path' value='"+path+"' type='hidden'>";
                var mediaType = 'text/html';                
                if(response != null && response.length > 0) {
                    var rep = response[0].getElementsByTagName('representation');
                    if(rep != null && rep.length > 0) {                        
                        if(rep[0].attributes.length > 0) {
                            var att = rep[0].attributes.getNamedItem('mediaType');
                            if(att != null)
                                mediaType = att.nodeValue
                        }
                    }
                    str += "<b>MimeType(readonly):</b><input id='mimeType' name='mimeType' value='"+mediaType+"' type='text' readonly><br/>";
                }
                str += "<br/><input value='Test Resource' type='button' onclick='testResource()'>";
                str += "</form>";
                document.getElementById('test3').innerHTML = str;
                try {
                    testResource();
                } catch(e) {}                
            }
            function testResource() {
                //var res = "/resource1";
                var path = document.forms[0].path.value;
                //alert("path "+path);
                var found = path.indexOf( "{" );
                if (found != -1){
                    if(document.forms[0].params != null) {
                        var len = document.forms[0].params.length;
                        for(j=0;j<len;j++) {
                            var param = document.forms[0].params[j]
                            var pname = param.value;
                            //alert(pname);
                            path = path.replace("{"+param.name+"}", pname);
                        }
                    }
                }
                var req = baseURL+path;
                //alert("req "+req);
                //xmlhttpGet(req, null, '');

                var mimetype = getRep();
                updatepage('request', req);
                updatepage('amimetype', mimetype);
                //alert("mimetype "+mimetype);
                if (mimetype == 'image/jpg') {//image
                    alert('The image/jpg MimeType currently does not work with the MimeType selection method.\nInstead of seeing the image, you will see the image data');
                    //xmlhttpGet(req, mimetype);
                } else 
                    xmlhttpGet(req, mimetype, '');                
            }
            function testResource2(i) {
                var path2 = document.getElementById('path2_'+i);
                //alert(path2.value);
                document.getElementById('customer').innerHTML = i;
                xmlhttpGet(baseURL+path2.value, 'application/xml', '');
            }
            function updateContent(xmlHttpReq) {
                try {
                    if (xmlHttpReq.readyState == 4) {
                        var content = xmlHttpReq.responseText;
                        //alert("content "+content);
                        if(content.indexOf("customer-ref") != -1) {
                            content = getCustomersTable(content);
                            updatepage('result', content);
                        } else if(content.indexOf("address-ref") != -1) {
                            var custSel = document.getElementById('customer');
                            if(custSel != null) {
                                var i = custSel.innerHTML;                                
                                content = content.replace(/~lt~/g, "<");
                                var cell = document.getElementById('cell'+i);
                                if(cell != null)
                                    cell.innerHTML = content;
                                else
                                    updatepage('result', content);
                            }
                        } else {
                            updatepage('result', content);
                        }                        
                        updatepage('resultheaders', xmlHttpReq.getAllResponseHeaders());
                    } else {
                        log("state: "+xmlHttpReq.readyState);
                    }
                } catch( e ) {
                    alert('Caught Exception1: ' + e.description);
                }
            } 
            function loadXml(xmlStr) {
                var doc2;
                // code for IE
                if (window.ActiveXObject)
                {
                    doc2=new ActiveXObject("Microsoft.XMLDOM");
                    doc2.async="false";
                    doc2.loadXML(xmlStr);
                }
                // code for Mozilla, Firefox, Opera, etc.
                else
                {
                    var parser=new DOMParser();
                    doc2=parser.parseFromString(xmlStr,"text/xml");
                }
                return doc2;
            }
            function getCustomersTable(xmlStr) {
                var ret = xmlStr.replace(/~lt~/g, "<");
                var doc2 = loadXml(ret);
                if(doc2 != null) {
                    var customers=doc2.documentElement;
                    //alert(customers.nodeName);
                    var str = "<h4>"+customers.nodeName+"</h4>";
                    str += "<form action='' method=GET name='form2'>";
                    str += "<table class='results' border='1'>";
                    str += "<thead class='resultHeader'>";
                    var colNames = new Array()
                    colNames[0] = "Customer ID"
                    colNames[1] = "Customer URI"
                    colNames[2] = "Description"
                    var colSizes = new Array()
                    colSizes[0] = "80"
                    colSizes[1] = "250"
                    colSizes[2] = "350"
                    for (i=0;i<colNames.length;i++) {
                        str += "<th width='"+colSizes[i]+"' align='left'><font color='#FFFFFF'><b>"+colNames[i]+"</b></font></th>";
                    }
                    str += "</thead>";
                    str += "<tbody>";
                    var custrefs = customers.getElementsByTagName('customer-ref');
                    //alert(custrefs.length);
                    for(i=0;i<custrefs.length;i++) {
                        str += "<tr style='font-size: 9px;'>";
                        var custref = custrefs[i];
                        //alert(custref.nodeName);
                        //alert(custref.attributes.getNamedItem('uri').nodeValue);                        
                        var custid = custref.getElementsByTagName('customer_id')[0];
                        //alert(custid.nodeName);
                        var uri = custref.attributes.getNamedItem('uri').nodeValue;
                        str += "<td>"+custid.childNodes[0].nodeValue+"</td>";
                        str += "<td>";                        
                        str += "<input id='path2_"+i+"' name='path' value='"+uri+"' type='hidden'>";
                        str += uri+"<input value=Go type=button onclick='testResource2("+i+")'>";
                        str += "</td>";
                        str += "<td id='cell"+i+"'>&nbsp;</td>";
                        str += "</tr>";
                    }
                    str += "</tbody></table></form>";
                    ret = str;
                }
                return ret;
            }
            function updatepage(id, str){
                //alert('updatepage: '+id+" str: "+str);
                document.getElementById(id).innerHTML = str;
            }
            function log(msg) {
                //alert(msg);
                document.getElementById('log').innerHTML = msg;
            }
            function getRep() {
              var resource = document.getElementById('mimeType');
              return resource.value;
            }
            function getSelMethod() {
                for (counter = 0; counter < form1.selMethod.length; counter++) {
                    // If a radio button has been selected it will return true
                    // (If not it will return false)
                    if (form1.selMethod[counter].checked)
                        return form1.selMethod[counter].value;
                }
                return null;
            }
            function getSelectorValue(selectorId) {
                var resource = document.getElementById(selectorId);
                log("selector "+resource.name);
                var myIndex = resource.selectedIndex;
                log("index: " +myIndex);
                log(resource.options);
                log(resource.options[myIndex].value);
                return resource.options[myIndex].value 
            }
            function init() {
                var status = xmlhttpGet(wadlURL, null, 'menu');
                if(status) {
                    showCategory('resources');
                } else {
                    setvisibility('main', 'inherit');
                    var str = '<b>Help Page</b><br/><br/>If this page is accessed using mozilla, then edit user.js or prefs.js found in your ';
                    str += 'mozilla profile folder. <br/><ul>';
                    str += '<li>On Windows Vista/XP/2000, the path is usually %AppData%\\Mozilla\\Firefox\\Profiles\\xxxxxxxx.default\\, <br/>';
                    str += 'where xxxxxxxx is a random string of 8 characters. Just browse to <br/>';
                    str += 'C:\\Documents and Settings\\[User Name]\\Application Data\\Mozilla\\Firefox\\Profiles\\ on Windows XP/2000 <br/>';
                    str += 'or C:\\users\\[User Name]\\AppData\\Roaming\\Mozilla\\Firefox\\Profiles\\ on Windows Vista, and the rest should be obvious.</li>'; 
                    str += '<li>On Windows 95/98/Me, the path is usually C:\\WINDOWS\\Application Data\\Mozilla\\Firefox\\Profiles\\xxxxxxxx.default\\</li>';
                    str += '<li>On Linux, the path is usually ~/.mozilla/firefox/xxxxxxxx.default</li>';
                    str += '<li>On Mac OS X, the path is usually ~/Library/Application Support/Firefox/Profiles/xxxxxxxx.default</li></ul>';
                    str += 'Please exit all instance of mozilla browser, then add the following lines to user.js or prefs.js file, and start mozilla browser<br/><br/>';
                    str += 'user_pref("capability.policy.XMLHttpRequestToAnySite.XMLHttpRequest.open", "allAccess");<br/>'; 
                    str += 'user_pref("capability.policy.XMLHttpRequestToAnySite.sites", "http://localhost");<br/>';
                    str += 'user_pref("capability.policy.policynames", "XMLHttpRequestToAnySite");<br/><br/>';
                    str += 'See http://www.mozilla.org/support/firefox/edit for more details.';
                    document.getElementById('content').innerHTML = str;
                }            
            }
        </script>

        <script language="Javascript">
            var expand = new Image();
            expand.src = "expand.gif";
            var collapse = new Image();
            collapse.src = "collapse.gif";

            function tree(){
                this.categories = new Array();
                this.add = addCategory;
                this.toString = getTreeString;
            }

            function category(id, text){
                this.id = id;
                this.text = text;
                this.write = writeCategory;
                this.add = addItem;
                this.items = new Array();
            }

            function item(text, link){
                this.text = text;
                this.link = link;
                this.write = writeItem;
            }

            function getTreeString(){
                var treeString = '';
                for(var i=0;i<this.categories.length;i++) {
                    treeString += this.categories[i].write();
                }
                return treeString;
            }

            function addCategory(category){
                this.categories[this.categories.length] = category;
            }

            function writeCategory(){
                var categoryString = '<span class="category" onClick="showCategory(\'' + this.id + '\')"';
                categoryString += '><img src="collapse.gif" id="I' + this.id + '">' + this.text;
                categoryString += '</span>';
                categoryString += '<span class="item" id="';
                categoryString += this.id + '">';
                var numitems = this.items.length;
                for(var j=0;j<numitems;j++)
                    categoryString += this.items[j].write();
                categoryString += '</span>';
                return categoryString;
            }

            function addItem(item){
                this.items[this.items.length] = item;
            }

            function writeItem(){
                var itemString = '<a href="#" onClick="' + this.link + '">';
                itemString += '<img src="item.gif" border="0">';
                itemString += this.text;
                itemString += '</a><br>';
                return itemString;
            }

            function showCategory(category){
                var categoryNode = document.getElementById(category).style;
                if(categoryNode.display=="block")
                    categoryNode.display="none";
                else
                    categoryNode.display="block";
                changeGesture('I' + category);
            }

            function changeGesture(img){
                ImageNode = document.getElementById(img);
                if(ImageNode.src.indexOf('collapse.gif')>-1)
                    ImageNode.src = expand.src;
                else
                    ImageNode.src = collapse.src;
            }            
        </script>        
    </head>
    <body>       
        <div class="outerBorder">            
            <div class="header">
                <div class="banner">Testing Resource Beans</div>
                <div id="subheader" class="subheader"></div> <!-- sub-header -->
            </div> <!-- header -->
            <div id="main" class="main" style="visibility: hidden;">
                        <div id="leftSidebar" class="leftSidebar"></div> <!-- leftSidebar -->
                        <div id="content" class="content">
                            <div id="test3" class="details"></div>
                            <hr>
                            <div id="details" class="details">
                                <b>Test Details:</b><br><br>
                                <b>Request:</b> <div id="request"></div><br>                               
                                <b>Result:</b> <div id="result"></div><br>
                                <b>Accept MimeType:</b> <div id="amimetype"></div><br>
                                <b>Result Headers:</b> <div id="resultheaders"></div>
                            </div>
                            <hr>
                            <b class="details">Debug Log:</b><div id="log" class="details"></div>
                        </div> <!-- content -->      
            </div> <!-- main -->
        </div> <!-- outerborder -->
        <script language="Javascript">
            init();
        </script>    
    </body>
<div id='customer' style="visibility: hidden;"></div>
</html>