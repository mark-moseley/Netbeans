<?xml version="1.0" encoding="UTF-8"?>
<project name="Gangster CMP 2.0" default="build" basedir=".">
        <property file="appserver.properties"/>
	<!-- internal build locations -->
	<property name="app.name" value="gangster-cmp2"/>
	<property name="dist.dir" value="."/>
	<property name="client.jar" value="${app.name}-client.jar"/>
	<property name="dist.jar" value="${app.name}.jar"/>
	<property name="lib.dir" value="lib"/>
	<property name="src.dir" value="src"/>
	<property name="src.main" value="${src.dir}/main"/>
	<property name="src.resources" value="${src.dir}/resources"/>
	<property name="src.war" value="${src.dir}/war"/>
	<property name="build.dir" value="output"/>
	<property name="build.classes" value="${build.dir}/classes"/>
	<property name="build.lib" value="${build.dir}/lib"/>
	<path id="base.path">
		<fileset dir="${appserver.home}/lib">
			<include name="*.jar"/>
		</fileset>
		<fileset dir="${lib.dir}">
			<include name="*.jar"/>
		</fileset>
		<pathelement location="${build.classes}"/>
	</path>
	<path id="test.path">
		<fileset dir="${appserver.home}/client">
			<include name="*.jar"/>
		</fileset>
		<fileset dir="${lib.dir}">
			<include name="*.jar"/>
		</fileset>
		<pathelement location="${build.classes}"/>
	</path>
	<target name="prepare">
		<mkdir dir="${build.dir}"/>
		<mkdir dir="${build.classes}"/>
		<mkdir dir="${build.lib}"/>
	</target>
	<target name="clean" depends="cleandist">
		<delete dir="${build.dir}"/>
	</target>
	<target name="compile" depends="prepare">
		<javac srcdir="${src.main}" destdir="${build.classes}" debug="on" optimize="off" deprecation="off">
			<classpath refid="base.path"/>
		</javac>
	</target>
	<target name="cleandist">
		<delete dir="${build.lib}"/>
	</target>
	<target name="build-client.jar" depends="cleandist, compile">
		<jar jarfile="${build.lib}/${client.jar}">
			<fileset dir="${build.classes}" excludes="org/jboss/docs/cmp2/scan/**/*Bean.class"/>
		</jar>
	</target>
	<target name="build-ejb.jar" depends="cleandist, compile">
		<jar jarfile="${build.lib}/${dist.jar}">
			<fileset dir="${build.classes}" excludes="org/jboss/docs/cmp2/scan/**/*.*"/>
			<fileset dir="${src.resources}/ejb-jar">
				<exclude name="META-INF/MANIFEST.MF"/>
			</fileset>
			<zipfileset src="${lib.dir}/junitejb.jar" includes="net/**/*.*"/>
			<zipfileset src="${lib.dir}/junit.jar" includes="junit/**/*.*"/>
		</jar>
	</target>
	<target name="build" depends="build-ejb.jar, build-client.jar"/>
	
	<target name="setup" depends="compile">
		<java fork="yes" classname="junit.textui.TestRunner" taskname="junit" failonerror="true">
			<arg value="org.jboss.docs.cmp2.crimeportal.CrimePortalSetUp"/>
			<sysproperty key="java.naming.factory.initial" value="org.jnp.interfaces.NamingContextFactory"/>
			<sysproperty key="java.naming.provider.url" value="jnp://localhost:1099"/>
			<sysproperty key="java.naming.factory.url.pkgs" value="org.jboss.naming:org.jnp.interfaces"/>
			<classpath refid="test.path"/>
		</java>
	</target>
	<target name="test" depends="compile">
		<java fork="yes" classname="junit.textui.TestRunner" taskname="junit" failonerror="true">
			<arg value="org.jboss.docs.cmp2.crimeportal.CrimePortalTest"/>
			<sysproperty key="java.naming.factory.initial" value="org.jnp.interfaces.NamingContextFactory"/>
			<sysproperty key="java.naming.provider.url" value="jnp://localhost:1099"/>
			<sysproperty key="java.naming.factory.url.pkgs" value="org.jboss.naming:org.jnp.interfaces"/>
			<classpath refid="test.path"/>
		</java>
	</target>
	<target name="teardown" depends="compile">
		<java fork="yes" classname="junit.textui.TestRunner" taskname="junit" failonerror="true">
			<arg value="org.jboss.docs.cmp2.crimeportal.CrimePortalTearDown"/>
			<sysproperty key="java.naming.factory.initial" value="org.jnp.interfaces.NamingContextFactory"/>
			<sysproperty key="java.naming.provider.url" value="jnp://localhost:1099"/>
			<sysproperty key="java.naming.factory.url.pkgs" value="org.jboss.naming:org.jnp.interfaces"/>
			<classpath refid="test.path"/>
		</java>
	</target>
	<target name="test-gui" depends="compile">
		<java fork="yes" classname="junit.swingui.TestRunner" taskname="junit" failonerror="true">
			<arg value="org.jboss.docs.cmp2.crimeportal.CrimePortalTest"/>
			<sysproperty key="java.naming.factory.initial" value="org.jnp.interfaces.NamingContextFactory"/>
			<sysproperty key="java.naming.provider.url" value="jnp://localhost:1099"/>
			<sysproperty key="java.naming.factory.url.pkgs" value="org.jboss.naming:org.jnp.interfaces"/>
			<classpath refid="test.path"/>
		</java>
	</target>
</project>
