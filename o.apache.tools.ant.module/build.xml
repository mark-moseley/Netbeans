<?xml version="1.0"?>

<!--@(#)build.xml-->
<!--Ant project for the Ant Module for Sun's Forte For Java IDE-->
<!--@author Jayme Edwards-->

<project name="Ant Module" default="netbeans" basedir=".">

<!-- Older build code deprecated since the IDE has a standard build scheme now:
  <target name="setProps">
    <property name="build.compiler" value="classic"/>
    <property name="dist.classes" value="classes"/>
    <property name="module.package" value="org${file.separator}apache${file.separator}tools${file.separator}ant${file.separator}module"/>
    <property name="module.classes" value="${dist.classes}${file.separator}${module.package}"/>
    <property name="module.javahelp" value="javahelp${file.separator}${module.package}${file.separator}docs"/>
    <property name="module.templates" value="tojar${file.separator}${module.package}"/>
    <property name="module.jar" value="tojar${file.separator}${module.package}${file.separator}templates.jar"/>
    <property name="module.libs" value=".${file.separator}release${file.separator}lib"/>
    <property name="module.ext" value="${module.libs}${file.separator}ext"/>
    <property name="module.src" value="src"/>
    <property name="build.classpath" value="${module.src};${module.ext}${file.separator}ant.jar;${module.ext}${file.separator}xml.jar;${module.ext}${file.separator}xerces.jar;${module.ext}${file.separator}xalan.jar;${module.ext}${file.separator}openide.jar"/>
  </target>
  <target name="preClean" depends="setProps">
    <delete dir="${dist.classes}"/>
  </target>
  <target name="postClean" depends="setProps">
    <delete dir="${dist.classes}"/>
  </target>
  <target name="prepare" depends="setProps">
    <mkdir dir="${dist.classes}"/>
  </target>
  <target name="build" depends="setProps">
    <echo message="compiling with classpath: ${build.classpath}"/>
    <javac srcdir="${module.src}" destdir="${dist.classes}" classpath="${build.classpath}"/>
  </target>
  <target name="packTemplates" depends="setProps">
    <jar jarfile="${module.classes}${file.separator}templates.jar" basedir="${module.jar}" includes="Ant/**"/>
  </target>
  <target name="packModule" depends="setProps">
    <copy todir="${module.classes}${file.separator}docs">
      <fileset dir="${module.javahelp}"/>
    </copy>
    <jar jarfile="${module.libs}${file.separator}antmodule.jar" basedir="${dist.classes}" manifest="manifest.mf" includes="${module.package}${file.separator}**" excludes="**/*.jar.MAKEME"/>
  </target>
  <target name="all" depends="preClean,prepare,build,packTemplates,packModule,postClean"/>
-->

  <!-- For including in an IDE build: -->

  <property name="binroot" value=".."/>
  <taskdef name="jhindexer" classname="org.netbeans.nbbuild.JHIndexer" classpath="../nbbuild/nbantext.jar"/>
  <taskdef name="makenbm" classname="org.netbeans.nbbuild.MakeNBM" classpath="../nbbuild/nbantext.jar"/>

  <target name="compile">
    <javac srcdir="src" destdir="src">
      <classpath>
        <pathelement location="../openide/netbeans/lib/openide.jar"/>
	<pathelement location="release/modules/ext/ant.jar"/>
	<pathelement location="release/modules/ext/xalan.jar"/>
	<pathelement location="release/modules/ext/xerces.jar"/>
	<!-- Using IDE's version of jaxp + parser, these cannot be overridden: -->
	<pathelement location="../core/release/lib/ext/jaxp.jar"/>
	<pathelement location="../core/release/lib/ext/parser.jar"/>
      </classpath>
    </javac>
  </target>

  <target name="jars" depends="compile">
    <mkdir dir="netbeans/modules"/>
    <filter token="BUILD_NUMBER_SUBST" value="${buildnumber}"/>
    <copy file="manifest.mf" tofile="manifest-subst.mf" filtering="on"/>
    <jar jarfile="netbeans/modules/ant.jar"
         manifest="manifest-subst.mf"
         basedir="src"
	 excludesfile="../nbbuild/standard-jar-excludes.txt"
	 compress="false">
      <include name="org/apache/tools/ant/module/"/>
    </jar>
    <mkdir dir="netbeans/modules/patches"/>
    <!-- Special patch to Ant 1.2 to help it work inside the IDE: -->
    <jar jarfile="netbeans/modules/patches/antclassloading.jar"
         basedir="src"
	 excludesfile="../nbbuild/standard-jar-excludes.txt"
	 compress="false">
      <include name="org/apache/tools/ant/AntClassLoader*.class"/>
      <include name="org/apache/tools/ant/taskdefs/Taskdef*.class"/>
    </jar>
  </target>

  <target name="release">
    <copy todir="netbeans" includeEmptyDirs="false">
      <fileset dir="release"/>
    </copy>
  </target>

  <target name="javahelp">
    <copy todir="netbeans/docs" includeEmptyDirs="false">
      <fileset dir="javahelp"/>
    </copy>
    <mkdir dir="netbeans/docs/org/apache/tools/ant/module/docs/JavaHelpSearch"/>
    <jhindexer basedir="javahelp/org/apache/tools/ant/module/docs"
               db="netbeans/docs/org/apache/tools/ant/module/docs/JavaHelpSearch"
               jhall="${binroot}/nbbuild/lib/jhall.jar">
      <include name="**/*.html"/>
      <exclude name="config-dep.html"/>
      <exclude name="config-prop.html"/>
      <exclude name="config-targ.html"/>
      <exclude name="credits.html"/>
    </jhindexer>
  </target>

  <target name="netbeans" depends="jars,release,javahelp"/>

  <target name="nbm" depends="netbeans">
    <makenbm file="ant.nbm"
             topdir="."
	     manifest="manifest-subst.mf"
	     homepage="http://ant.netbeans.org/"
	     distribution="http://www.netbeans.org/download/nbms/40/ant.nbm">
      <license name="ant-license.txt">
        For the Ant module itself:
        <file location="../nbbuild/standard-nbm-license.txt"/>
	For the Ant runtime:
	<file location="Ant_License"/>
	For the Xerces library:
	<file location="Xerces_License"/>
	For the Xalan library:
	<file location="Xalan_License"/>
      </license>
      <description>
        Support for Ant build scripts.
      </description>
      <signature keystore="${keystore}" storepass="${storepass}" alias="nb_ide"/>
    </makenbm>
  </target>

  <target name="clean">
    <delete>
      <fileset dir="src">
        <include name="**/*.class"/>
      </fileset>
    </delete>
    <delete file="manifest-subst.mf"/>
    <delete file="ant.nbm"/>
    <delete dir="netbeans"/>
    <delete dir="Info"/>
  </target>

</project>
