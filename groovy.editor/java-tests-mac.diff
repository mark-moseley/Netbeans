diff -r 2acbd9bc683f nbbuild/templates/common.xml
--- a/nbbuild/templates/common.xml	Fri Jul 04 09:35:36 2008 +0200
+++ b/nbbuild/templates/common.xml	Fri Jul 04 14:19:03 2008 +0200
@@ -442,6 +442,7 @@
                    debug="true" deprecation="${build.compiler.deprecation}" encoding="UTF-8"
                    source="${javac.source}" target="${javac.target}" optimize="${build.compiler.optimize}" includeantruntime="false">
                 <classpath refid="test.@{test.type}.cp"/>
+            	<bootclasspath refid="additional.mac.cp"/>
                 <compilerarg line="${javac.compilerargs}"/>
             </javac>
             <copy todir="${build.test.@{test.type}.classes.dir}">
@@ -506,6 +507,7 @@
                        debug="true" deprecation="${build.compiler.deprecation}" encoding="UTF-8"
                        source="${javac.source}" target="${javac.target}" includeantruntime="false" optimize="${build.compiler.optimize}" includes="${javac.includes}">
                     <classpath refid="test.@{test.type}.cp"/>
+            		<bootclasspath refid="additional.mac.cp"/>
                     <compilerarg line="${javac.compilerargs}"/>
                 </javac>
                 <copy todir="${build.test.@{test.type}.classes.dir}">
@@ -545,6 +547,7 @@
                     <fileset dir="${build.test.@{test.type}.classes.dir}" includes="${test.includes}" excludes="${test.excludes}"/>
                 </batchtest>
                 <classpath refid="test.@{test.type}.run.cp"/>
+            	<bootclasspath refid="additional.mac.cp"/>
                 <syspropertyset refid="test.@{test.type}.properties"/>
                 <jvmarg line="${test.run.args}"/>
                 <formatter type="brief" usefile="false"/>
@@ -572,6 +575,7 @@
                         <fileset dir="${test.@{test.type}.src.dir}" includes="${test.includes}"/>
                     </batchtest>
                     <classpath refid="test.@{test.type}.run.cp"/>
+                    <bootclasspath refid="additional.mac.cp"/>
                     <syspropertyset refid="test.@{test.type}.properties"/>
                     <jvmarg line="${test.run.args}"/>
                     <formatter type="brief" usefile="false"/>
@@ -604,6 +608,7 @@
                         <pathelement location="${ant.home}/lib/ant.jar"/>
                         <pathelement location="${ant.home}/lib/ant-junit.jar"/>
                     </classpath>
+                    <bootclasspath refid="additional.mac.cp"/>
                     <syspropertyset refid="test.@{test.type}.properties"/>
                     <arg value="${test.class}"/>
                     <arg value="showoutput=true"/>
@@ -801,4 +806,21 @@
             <fixtestdeps projectXml="nbproject/project.xml" 
                   propertiesFile="nbproject/project.properties"/>  
     </target>
+    
+    <!-- #97290: Additional classpath for tests on Mac OS X -->
+
+    <path id="additional.mac.cp">
+        <fileset dir="${nb_all}/libs.javacapi/external">
+            <include name="**/*.jar"/>
+        </fileset>
+
+        <fileset dir="${nb_all}/libs.javacimpl/external">
+            <include name="**/*.jar"/>
+        </fileset>
+
+        <pathelement path="/System/Library/Frameworks/JavaVM.framework/Classes/classes.jar"/>
+        <pathelement path="/System/Library/Frameworks/JavaVM.framework/Classes/laf.jar"/>
+        <pathelement path="/System/Library/Frameworks/JavaVM.framework/Classes/ui.jar"/>
+    </path>
+
 </project>
