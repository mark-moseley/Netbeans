<?xml version="1.0" encoding="UTF-8"?>

<project name="org.netbeans.modules.visualweb.webui.designtime" default="netbeans" basedir=".">
    
    <description>Builds and tests the project org.netbeans.modules.visualweb.webui.designtime.</description>
    <import file="nbproject/build-impl.xml"/>
    <import file="${suite.dir}/templates/common.xml"/>
    
    <target name="init" depends="harness.init,generate"/>
    
    <target name="generate" depends="harness.init,pre-generate" unless="generated-uptodate">
        <antcall target="validate"/>
        <echo>Generating BeanInfo base classes for non-visual components...</echo>
        <java classname="com.sun.rave.jsfmeta.generators.Main" fork="true">
            <arg line="-d ${src.dir}"/>
            <arg line="-f ${gen.file.webui_sun_beans_config}"/>
            <arg line="-f ${gen.file.webui_designtime_sun_beans_config}"/>
            <arg line="-v"/>
            <arg line="-c com.sun.rave.designtime.base.CategoryDescriptors"/>
            <arg line="-P org.netbeans.modules.visualweb.web.ui.dt.faces"/>
            <arg line="--cpBeanInfoBase"/>
            <classpath>
                <pathelement path="${gen.classpath}"/>
            </classpath>
        </java>
        <echo>Generating BeanInfo base classes for visual components...</echo>
        <java classname="com.sun.rave.jsfmeta.generators.Main" fork="true">
            <arg line="-d ${src.dir}"/>
            <arg line="-f ${gen.file.standard_faces_config}"/>
            <arg line="-f ${gen.file.standard_faces_config_overlay}"/>
            <arg line="-f ${gen.file.webui_faces_config_overlay}"/>
            <arg line="-x"/>
            <arg line="-f ${gen.file.webui_faces_config}"/>
            <arg line="-f ${gen.file.webui_sun_faces_config}"/>
            <arg line="-f ${gen.file.webui_designtime_sun_faces_config}"/>
            <arg line="-p ui"/>
            <arg line="-u http://www.sun.com/web/ui"/>
            <arg line="-v"/>
            <arg line="-c com.sun.rave.designtime.base.CategoryDescriptors"/>  
            <arg line="-P org.netbeans.modules.visualweb.web.ui.dt.component"/>          
            <arg line="--cpBeanInfoBase"/>
            <classpath>
                <pathelement path="${gen.classpath}"/>
            </classpath>
        </java>
        <touch file="${gen.timestamp.file}"/>
    </target>
    
    <target name="pre-generate">
        <uptodate property="generated-uptodate" targetfile="${gen.timestamp.file}">
            <srcfiles dir="conf" includes="**/*.xml"/>
        </uptodate>
    </target>  

    <target name="validate" depends="harness.init">
        <xmlcatalog id="faces-catalog">
            <dtd publicId="-//Sun Microsystems, Inc.//DTD JavaServer Faces Overlay 1.0//EN"
              location="../../ravelibs/jsf-api/conf/web-facesconfig-overlay_1_0.dtd"/>
            <dtd publicId="-//Sun Microsystems, Inc.//DTD JavaServer Faces Overlay 1.1//EN"
              location="../../ravelibs/jsf-api/conf/web-facesconfig-overlay_1_1.dtd"/>
            <dtd publicId="-//Sun Microsystems, Inc.//DTD JavaServer Faces Overlay 1.2//EN"
              location="../../ravelibs/jsf-api/conf/web-facesconfig-overlay_1_2.dtd"/>
        </xmlcatalog>
        <xmlvalidate file="conf/sun-faces-config.xml" failonerror="true">
            <xmlcatalog refid="faces-catalog"/>
        </xmlvalidate>
        <xmlvalidate file="conf/sun-beans-config.xml" failonerror="true">
            <xmlcatalog refid="faces-catalog"/>
        </xmlvalidate>
    </target>
    
    <target name="jar" depends="init,compile,pre-jar,projectized-common.jar"/>
    
    <!-- Copy faces-config files to build area, so that they are packaged into the module JAR. 
         This is necessary, because the design-time module contains JSF plugins, like a design-time
         render kit, which must be picked up by the faces configurator in the JSF reference
         implementation. -->
    <target name="pre-jar">
        <mkdir dir="${build.classes.dir}/META-INF"/>
        <copy todir="${build.classes.dir}/META-INF">
            <fileset dir="conf" includes="**/*.xml"/>
        </copy>
    </target>
    
    <target name="clean" depends="projectized-common.clean">
        <delete failonerror="false">
            <fileset dir="${src.dir}/org/netbeans/modules/visualweb/web/ui/dt/component" 
              includes="*BeanInfoBase.java,Bundle-JSF.properties"/>
        </delete>
        <delete failonerror="false">
            <fileset dir="${src.dir}/org/netbeans/modules/visualweb/web/ui/dt/faces"
              includes="*BeanInfoBase.java,Bundle-JSF.properties"/>
        </delete>
        <delete file="${gen.timestamp.file}" failonerror="false"/>
    </target>
    
</project>
